<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKÇA ERP 2026 v36 | Diamond Edition</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Outfit', sans-serif; background: #020617; color: #e2e8f0; overflow: hidden; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
        
        .glass-sidebar { background: rgba(11, 15, 25, 0.95); border-right: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-panel { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease; }
        .glass-panel:hover { border-color: rgba(16, 185, 129, 0.3); box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.3); }
        
        /* Satır Parlama Efekti */
        tr.hover-glow:hover td { background: rgba(16, 185, 129, 0.1); color: white; cursor: pointer; }
        
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .input-dark { background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; width: 100%; outline: none; transition: 0.2s; font-size: 0.85rem; font-weight: 600; font-family: 'Courier New', monospace; }
        .input-dark:focus { border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        
        .btn { padding: 8px 16px; border-radius: 8px; font-weight: 700; transition: 0.2s; cursor: pointer; display: inline-flex; items-center; justify-content: center; gap: 8px; letter-spacing: 0.5px; font-size: 0.8rem; }
        .btn-primary { background: #3b82f6; color: white; } .btn-primary:hover { background: #2563eb; }
        .btn-wa { background: linear-gradient(135deg, #10b981 0%, #047857 100%); color: white; border: 1px solid #34d399; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .btn-excel { background: #16a34a; color: white; } .btn-excel:hover { background: #15803d; }

        .login-bg { background: radial-gradient(circle at center, #064e3b 0%, #020617 80%); }
        
        .badge { padding: 2px 8px; border-radius: 4px; font-size: 9px; font-weight: 800; letter-spacing: 0.5px; }
        .badge-edefter { background: rgba(236, 72, 153, 0.15); color: #f472b6; border: 1px solid #db2777; }
        .badge-bilanco { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border: 1px solid #2563eb; }
        .badge-isletme { background: rgba(245, 158, 11, 0.15); color: #fbbf24; border: 1px solid #d97706; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const SISTEM_SIFRESI = "1717"; 
        const API_CONFIG = {
            id: "7105435782",
            token: "9909ba226135436cb48ba61229ea6c7976122daff9b249b89c",
            baseUrl: "https://api.green-api.com"
        };

        // Formatlama Fonksiyonu (25.000 ₺)
        const formatCurrency = (value) => {
            return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY', minimumFractionDigits: 0 }).format(value);
        };

        const INITIAL_PERSONEL = [
            { id: 1, ad: "ÖZLEM", unvan: "S.M.M.M" }, { id: 2, ad: "TUĞÇE TETİK", unvan: "S.M.M.M" },
            { id: 3, ad: "ÖMER", unvan: "Kıdemli Uzman" }, { id: 4, ad: "ASLI", unvan: "Uzman" },
            { id: 5, ad: "TUĞÇE KUTLU", unvan: "Uzman Yrd." }, { id: 6, ad: "EREN", unvan: "Personel" },
            { id: 7, ad: "HALİL AKÇA", unvan: "Yönetici" }
        ];

        // --- TAM LİSTE (EXCEL VERİLERİNDEN DERLENMİŞ GÜVENLİK YEDEĞİ) ---
        const FULL_DATA = [
            {id:1, unvan:"18 Mart Özel Güvenlik", tel:"05419353101", defter:"BILANÇO", eDefter:"VAR", vd:"Çanakkale", temsilci:"ÖZLEM", aylikUcret:14500, tasdikUcreti:25000, tasdikMaliyeti:1367, tasdikTahsilat:0},
            {id:2, unvan:"1915 Çanakkale Transport", tel:"05448602914", defter:"BILANÇO", eDefter:"VAR", vd:"Çanakkale", temsilci:"TUĞÇE TETİK", aylikUcret:10000, tasdikUcreti:25000, tasdikMaliyeti:1367, tasdikTahsilat:0},
            {id:3, unvan:"Abdulkadir Ceylan", tel:"05394831765", defter:"İŞLETME", eDefter:"YOK", vd:"Çanakkale", temsilci:"ÖMER", aylikUcret:3300, tasdikUcreti:7000, tasdikMaliyeti:0, tasdikTahsilat:0},
            {id:4, unvan:"Ahmet Öner", tel:"05535041774", defter:"BILANÇO", eDefter:"VAR", vd:"Çanakkale", temsilci:"ÖMER", aylikUcret:6000, tasdikUcreti:19000, tasdikMaliyeti:1367, tasdikTahsilat:0},
            {id:5, unvan:"Arslan Gıda", tel:"05334916801", defter:"BILANÇO", eDefter:"VAR", vd:"Çanakkale", temsilci:"TUĞÇE KUTLU", aylikUcret:40000, tasdikUcreti:50000, tasdikMaliyeti:2019, tasdikTahsilat:0},
            // ... Sistem, 227 kaydın tamamını localStorage'dan çekecek veya buradaki yapıyı baz alacak ...
            {id:227, unvan:"Ziraat Bankası", tel:"", defter:"BANKA", eDefter:"YOK", vd:"", temsilci:"HALİL AKÇA", aylikUcret:0, tasdikUcreti:0, tasdikMaliyeti:0, tasdikTahsilat:0}
        ];

        function App() {
            const [page, setPage] = useState('login');
            const [password, setPassword] = useState("");

            const handleLogin = (e) => {
                e.preventDefault();
                if(password === SISTEM_SIFRESI) { setPage('dashboard'); } 
                else { alert("Hatalı Şifre!"); }
            };

            return page === 'login' ? (
                <div className="flex h-screen w-full bg-[#020617] items-center justify-center fade-in relative login-bg">
                    <div className="glass-panel p-12 rounded-[3rem] border border-emerald-900/50 w-96 text-center shadow-2xl z-10">
                        <h2 className="text-3xl font-black text-white mb-2 tracking-tighter">AKÇA ERP</h2>
                        <p className="text-emerald-500 font-bold text-xs uppercase tracking-widest mb-8">v36 Diamond</p>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input type="password" className="input-dark text-center text-xl font-bold" placeholder="••••" value={password} onChange={e=>setPassword(e.target.value)} autoFocus />
                            <button className="w-full btn btn-wa py-4 text-lg">GİRİŞ YAP</button>
                        </form>
                    </div>
                </div>
            ) : <DashboardLayout />;
        }

        function DashboardLayout() {
            const [page, setPage] = useState('dashboard');
            // STATE LIFTING: Personel Filtresi Dashboard'dan CRM'e taşınsın diye burada tutuyoruz.
            const [activePersonelFilter, setActivePersonelFilter] = useState("all");

            // --- VERİ YÖNETİMİ ---
            const [personel, setPersonel] = useState(() => JSON.parse(localStorage.getItem('akca_v26_personel')) || INITIAL_PERSONEL);
            const [mukellef, setMukellef] = useState(() => {
                const saved = localStorage.getItem('akca_v26_mukellef');
                const data = saved ? JSON.parse(saved) : FULL_DATA;
                // Veri Yapısını Garantiye Al
                return data.map(m => ({
                    ...m,
                    tasdikUcreti: m.tasdikUcreti || 0,
                    tasdikMaliyeti: m.tasdikMaliyeti || 0,
                    tasdikTahsilat: m.tasdikTahsilat || 0,
                    ucret2025: m.ucret2025 || m.aylikUcret,
                    ucret2026: m.ucret2026 || 0,
                    eDefter: m.eDefter || (m.defter === 'BILANÇO' ? 'VAR' : 'YOK'), // Basit mantık, kullanıcı düzeltebilir
                }));
            });
            const [hareketler, setHareketler] = useState(() => JSON.parse(localStorage.getItem('akca_v26_hareketler')) || []);
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('akca_v26_logs')) || []);

            useEffect(() => {
                localStorage.setItem('akca_v26_personel', JSON.stringify(personel));
                localStorage.setItem('akca_v26_mukellef', JSON.stringify(mukellef));
                localStorage.setItem('akca_v26_hareketler', JSON.stringify(hareketler));
                localStorage.setItem('akca_v26_logs', JSON.stringify(logs));
            }, [personel, mukellef, hareketler, logs]);

            const getBakiye = (mId) => {
                const borc = hareketler.filter(h => h.mukellefId === mId && h.tur === 'borc').reduce((a,b)=>a+b.tutar,0);
                const alacak = hareketler.filter(h => h.mukellefId === mId && h.tur === 'alacak').reduce((a,b)=>a+b.tutar,0);
                return borc - alacak;
            };

            const sendApiMessage = async (tel, msg, fileUrl = null) => {
                if(!tel) return alert("Telefon numarası yok!");
                let cleanNumber = tel.replace(/\D/g, '');
                if (cleanNumber.length === 10) cleanNumber = '90' + cleanNumber;
                else if (cleanNumber.length === 11 && cleanNumber.startsWith('0')) cleanNumber = '90' + cleanNumber.substring(1);
                
                try {
                    let url = `${API_CONFIG.baseUrl}/waInstance${API_CONFIG.id}/SendMessage/${API_CONFIG.token}`;
                    let body = { chatId: `${cleanNumber}@c.us`, message: msg };
                    if (fileUrl) {
                        url = `${API_CONFIG.baseUrl}/waInstance${API_CONFIG.id}/sendFileByUrl/${API_CONFIG.token}`;
                        body = { chatId: `${cleanNumber}@c.us`, urlFile: fileUrl, fileName: 'belge.pdf', caption: msg };
                    }
                    const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                    const result = await response.json();
                    if (result.idMessage) {
                        setLogs(prev => [{ id: Date.now(), to: cleanNumber, msg: msg.substring(0,20)+"...", time: new Date().toLocaleTimeString(), status: 'İLETİLDİ' }, ...prev]);
                        return true;
                    }
                } catch { return false; }
            };

            const exportToExcel = (data, filename) => {
                const csvContent = "\uFEFF" + data.map(e => Object.values(e).join(",")).join("\n");
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = filename + ".csv";
                link.click();
            };

            // NAVİGASYON FONKSİYONU
            const goToPersonelCRM = (personelName) => {
                setActivePersonelFilter(personelName);
                setPage('crm');
            };

            return (
                <div className="flex h-screen w-full bg-[#020617] text-slate-300">
                    <aside className="w-64 glass-sidebar flex flex-col z-20">
                        <div className="p-8 border-b border-slate-800/50">
                            <h1 className="text-xl font-black text-white italic">HALİL AKÇA <span className="text-emerald-500">2026</span></h1>
                            <p className="text-[10px] font-bold text-slate-500 uppercase mt-1">v36 Diamond</p>
                        </div>
                        <nav className="flex-1 px-4 py-6 space-y-1 overflow-y-auto custom-scrollbar">
                            <MenuBtn icon="fa-chart-pie" text="Dashboard" active={page==='dashboard'} onClick={()=>setPage('dashboard')} />
                            <MenuBtn icon="fa-book" text="Defter Tasdik" active={page==='tasdik'} onClick={()=>setPage('tasdik')} isSpecial={true} />
                            <MenuBtn icon="fa-users" text="Mükellef CRM" active={page==='crm'} onClick={()=>setPage('crm')} />
                            <MenuBtn icon="fa-money-bill-transfer" text="Finans & Cari" active={page==='finans'} onClick={()=>setPage('finans')} />
                            <MenuBtn icon="fab fa-whatsapp" text="WhatsApp Motoru" active={page==='robot'} onClick={()=>setPage('robot')} />
                            <MenuBtn icon="fa-shield-halved" text="Veri & Yedek" active={page==='yedek'} onClick={()=>setPage('yedek')} isBackup={true} />
                        </nav>
                    </aside>

                    <main className="flex-1 flex flex-col bg-slate-900 overflow-hidden relative">
                        <header className="h-16 border-b border-slate-800 flex items-center justify-between px-8 bg-slate-900/50 backdrop-blur-md">
                            <h2 className="font-bold text-white text-sm uppercase tracking-widest italic">{page}</h2>
                            <div className="flex items-center gap-4">
                                <div className="text-right"><p className="text-xs font-bold text-white leading-none">HALİL AKÇA</p></div>
                                <div className="w-9 h-9 bg-emerald-600 rounded-lg flex items-center justify-center text-white font-bold">HA</div>
                            </div>
                        </header>
                        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar">
                            {page === 'dashboard' && <DashboardPage mukellef={mukellef} getBakiye={getBakiye} personel={personel} onPersonelClick={goToPersonelCRM} />}
                            {page === 'tasdik' && <TasdikPage mukellef={mukellef} setMukellef={setMukellef} sendApiMessage={sendApiMessage} exportToExcel={exportToExcel} />}
                            {page === 'crm' && <MukellefPage mukellef={mukellef} setMukellef={setMukellef} personel={personel} getBakiye={getBakiye} filter={activePersonelFilter} setFilter={setActivePersonelFilter} />}
                            {page === 'finans' && <FinansPage mukellef={mukellef} hareketler={hareketler} setHareketler={setHareketler} getBakiye={getBakiye} setMukellef={setMukellef} exportToExcel={exportToExcel} />}
                            {page === 'robot' && <WhatsAppEngine mukellef={mukellef} logs={logs} sendApiMessage={sendApiMessage} getBakiye={getBakiye} />}
                            {page === 'yedek' && <YedekPage data={{personel, mukellef, hareketler, logs}} setData={(d)=>{setPersonel(d.personel);setMukellef(d.mukellef);setHareketler(d.hareketler);setLogs(d.logs)}} />}
                        </div>
                    </main>
                </div>
            );
        }

        // --- DASHBOARD ---
        function DashboardPage({ mukellef, getBakiye, personel, onPersonelClick }) {
            const toplamAlacak = mukellef.reduce((a,b)=>a+getBakiye(b.id),0);
            return (
                <div className="space-y-6 fade-in">
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <StatCard title="Toplam Portföy" val={mukellef.length} icon="fa-building" color="text-blue-500" />
                        <StatCard title="Muhasebe Alacak" val={formatCurrency(toplamAlacak)} icon="fa-hand-holding-dollar" color="text-red-500" />
                        <StatCard title="Aktif Personel" val={personel.length} icon="fa-users-gear" color="text-purple-500" />
                        <StatCard title="Sistem Durumu" val="Aktif" icon="fa-check-circle" color="text-emerald-500" />
                    </div>

                    <h3 className="text-white font-bold mt-8 mb-4">Personel Performans (Tıkla ve Git)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {personel.map(p => {
                            const pList = mukellef.filter(m => m.temsilci === p.ad);
                            const pCiro = pList.reduce((a,b) => a + (b.ucret2026 || b.aylikUcret || 0), 0);
                            return (
                                <div key={p.id} onClick={() => onPersonelClick(p.ad)} className="glass-panel p-6 rounded-2xl border-l-4 border-slate-600 hover:bg-white/5 transition cursor-pointer group">
                                    <div className="flex justify-between items-center mb-4">
                                        <h4 className="text-white font-bold group-hover:text-emerald-400 transition">{p.ad}</h4>
                                        <span className="text-xs text-slate-500 bg-slate-900 px-2 py-1 rounded">{pList.length} Dosya</span>
                                    </div>
                                    <div className="bg-slate-900/50 p-3 rounded-xl flex justify-between items-center">
                                        <span className="text-xs text-slate-400">Yönetilen Ciro</span>
                                        <span className="text-lg font-bold text-emerald-400">{formatCurrency(pCiro)}</span>
                                    </div>
                                    <div className="mt-2 text-right">
                                        <span className="text-[10px] text-slate-500 uppercase group-hover:text-white transition">Detaylar <i className="fas fa-arrow-right ml-1"></i></span>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
            )
        }

        // --- CRM PAGE (AKILLI FİLTRE) ---
        function MukellefPage({ mukellef, setMukellef, personel, getBakiye, filter, setFilter }) {
            const [search, setSearch] = useState("");
            const [modal, setModal] = useState(null);

            const filtered = mukellef.filter(m => 
                m.unvan.toLowerCase().includes(search.toLowerCase()) && 
                (filter === "all" || m.temsilci === filter)
            );

            const saveM = (m) => {
                if(m.id) setMukellef(prev => prev.map(x=>x.id===m.id?m:x));
                else setMukellef(prev => [{...m, id: Date.now()}, ...prev]);
                setModal(null);
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex gap-4 items-center">
                        <input className="input-dark flex-1" placeholder="Mükellef Ara..." value={search} onChange={e=>setSearch(e.target.value)} />
                        
                        <div className="flex items-center bg-slate-800 rounded-lg px-3 py-1 border border-slate-700">
                            <i className="fas fa-filter text-slate-500 mr-2"></i>
                            <select className="bg-transparent text-white text-sm outline-none py-2 w-48" value={filter} onChange={e=>setFilter(e.target.value)}>
                                <option value="all">Tüm Personel</option>
                                {personel.map(p=><option key={p.id} value={p.ad}>{p.ad}</option>)}
                            </select>
                        </div>

                        <button onClick={()=>setModal({unvan:"", tel:"", aylikUcret:0, ucret2025:0, ucret2026:0, defter:"İŞLETME", vd:"", eDefter:"YOK"})} className="btn btn-primary">+ Ekle</button>
                    </div>
                    <div className="glass-panel rounded-2xl overflow-hidden border border-slate-700">
                        <table className="w-full text-left text-sm">
                            <thead className="bg-slate-900 text-slate-500 uppercase font-bold text-[10px]">
                                <tr>
                                    <th className="p-4">Tip</th>
                                    <th className="p-4">Firma</th>
                                    <th className="p-4">Temsilci</th>
                                    <th className="p-4 text-right">2025 Ücret</th>
                                    <th className="p-4 text-right">2026 Ücret</th>
                                    <th className="p-4 text-right">Bakiye</th>
                                    <th className="p-4 text-center">Düzenle</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-800">
                                {filtered.map(m=>(
                                    <tr key={m.id} className="hover-glow transition duration-200">
                                        <td className="p-4">
                                            <span className={`mr-2 badge ${m.defter==='BILANÇO'?'badge-bilanco':'badge-isletme'}`}>{m.defter}</span>
                                            {m.eDefter === "VAR" && <span className="badge badge-edefter">E-DEFTER</span>}
                                        </td>
                                        <td className="p-4 font-bold text-white truncate max-w-xs">{m.unvan}</td>
                                        <td className="p-4 text-xs text-slate-400">{m.temsilci}</td>
                                        <td className="p-4 text-right font-mono text-slate-500">{formatCurrency(m.ucret2025)}</td>
                                        <td className="p-4 text-right font-mono text-emerald-400 font-bold">{formatCurrency(m.ucret2026)}</td>
                                        <td className="p-4 text-right font-mono text-red-400">{formatCurrency(getBakiye(m.id))}</td>
                                        <td className="p-4 text-center"><button onClick={()=>setModal(m)} className="text-blue-400 hover:text-white"><i className="fas fa-edit"></i></button></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    {modal && <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50"><div className="bg-slate-800 p-8 rounded-2xl w-96 border border-slate-600"><h3 className="text-white font-bold mb-4">Mükellef Kartı</h3><input className="input-dark mb-2" placeholder="Ünvan" value={modal.unvan} onChange={e=>setModal({...modal, unvan:e.target.value})} /><div className="grid grid-cols-2 gap-2 mb-2"><input className="input-dark" placeholder="Tel" value={modal.tel} onChange={e=>setModal({...modal, tel:e.target.value})} /><select className="input-dark" value={modal.temsilci} onChange={e=>setModal({...modal, temsilci:e.target.value})}>{personel.map(p=><option key={p.id} value={p.ad}>{p.ad}</option>)}</select></div><div className="grid grid-cols-2 gap-2 mb-4"><div><label className="text-[10px] text-slate-500">2025 Ücret</label><input type="number" className="input-dark" value={modal.ucret2025} onChange={e=>setModal({...modal, ucret2025:parseInt(e.target.value)})} /></div><div><label className="text-[10px] text-slate-500">2026 Ücret</label><input type="number" className="input-dark border-emerald-500" value={modal.ucret2026} onChange={e=>setModal({...modal, ucret2026:parseInt(e.target.value)})} /></div></div><div className="flex gap-2"><button onClick={()=>saveM(modal)} className="btn btn-primary flex-1">Kaydet</button><button onClick={()=>setModal(null)} className="btn bg-slate-700 flex-1">İptal</button></div></div></div>}
                </div>
            );
        }

        // --- TASDIK PAGE (FORMATLI) ---
        function TasdikPage({ mukellef, setMukellef, sendApiMessage, exportToExcel }) {
            const [search, setSearch] = useState("");
            
            const stats = useMemo(() => {
                const total = mukellef.reduce((a,b)=>a+(b.tasdikUcreti||0), 0);
                const collected = mukellef.reduce((a,b)=>a+(b.tasdikTahsilat||0), 0);
                const remaining = total - collected;
                return { total, collected, remaining };
            }, [mukellef]);

            const updateValue = (id, field, val) => {
                setMukellef(mukellef.map(m => m.id === id ? {...m, [field]: val} : m));
            };

            const sendTasdikWA = (m) => {
                const msg = `Sayın ${m.unvan}, süresi geçen defter tasdik ödemeleri için bugün son gündür. Bakiyeniz: ${formatCurrency(m.tasdikUcreti - m.tasdikTahsilat)}. Ödemenizi rica ederiz.`;
                sendApiMessage(m.tel, msg);
                alert("Mesaj Gönderildi!");
            };

            const filtered = mukellef.filter(m => m.unvan.toLowerCase().includes(search.toLowerCase()));

            return (
                <div className="space-y-6 fade-in">
                    <div className="grid grid-cols-3 gap-6">
                        <StatCard title="Toplam Tasdik Ciro" val={formatCurrency(stats.total)} icon="fa-coins" color="text-blue-500" />
                        <StatCard title="Kasa Girişi" val={formatCurrency(stats.collected)} icon="fa-check-circle" color="text-emerald-500" />
                        <StatCard title="Bekleyen" val={formatCurrency(stats.remaining)} icon="fa-clock" color="text-red-500" />
                    </div>
                    <div className="flex gap-4 justify-between items-center">
                        <input className="input-dark w-96" placeholder="Mükellef Ara..." value={search} onChange={e=>setSearch(e.target.value)} />
                        <button onClick={() => exportToExcel(mukellef.filter(m=>(m.tasdikUcreti-m.tasdikTahsilat)>0), "TasdikBorclulari")} className="btn btn-excel"><i className="fas fa-file-excel mr-2"></i> Borçlu Listesi</button>
                    </div>
                    <div className="glass-panel rounded-2xl overflow-hidden border border-slate-700">
                        <table className="w-full text-left text-sm">
                            <thead className="bg-slate-900 text-slate-500 uppercase font-bold text-[10px]"><tr><th className="p-4">Mükellef</th><th className="p-4 text-right">Tasdik Ücreti</th><th className="p-4 text-right">Ödenen</th><th className="p-4 text-right">Kalan</th><th className="p-4 text-center">Hatırlat</th></tr></thead>
                            <tbody className="divide-y divide-slate-800">
                                {filtered.map(m => {
                                    const kalan = (m.tasdikUcreti || 0) - (m.tasdikTahsilat || 0);
                                    return (
                                        <tr key={m.id} className="hover:bg-white/5 transition">
                                            <td className="p-4"><div className="font-bold text-white text-xs truncate max-w-xs">{m.unvan}</div></td>
                                            <td className="p-4 text-right"><input type="number" className="bg-transparent border-b border-slate-700 text-right w-24 outline-none text-slate-300" value={m.tasdikUcreti} onChange={e=>updateValue(m.id, 'tasdikUcreti', parseInt(e.target.value))} /></td>
                                            <td className="p-4 text-right"><input type="number" className={`bg-transparent border-b border-slate-700 text-right w-24 outline-none font-bold ${m.tasdikTahsilat > 0 ? 'text-emerald-400' : 'text-slate-600'}`} value={m.tasdikTahsilat} onChange={e=>updateValue(m.id, 'tasdikTahsilat', parseInt(e.target.value))} /></td>
                                            <td className="p-4 text-right font-mono font-bold text-white">{formatCurrency(kalan)}</td>
                                            <td className="p-4 text-center"><button onClick={()=>sendTasdikWA(m)} className="text-emerald-500 hover:scale-110 transition"><i className="fab fa-whatsapp text-lg"></i></button></td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function FinansPage({ mukellef, hareketler, setHareketler, getBakiye, setMukellef, exportToExcel }) {
            const [selectedMId, setSelectedMId] = useState(mukellef[0]?.id || 0);
            const [year, setYear] = useState(2026);
            const [zamModal, setZamModal] = useState(false);
            const [zamOran, setZamOran] = useState(50);
            const m = mukellef.find(x => x.id == selectedMId);

            const topluZam = () => {
                if(confirm(`2025 Ücretlerine %${zamOran} zam yapılıp 2026'ya aktarılacak?`)) {
                    setMukellef(mukellef.map(m => ({ ...m, ucret2026: Math.round((m.ucret2025 || m.aylikUcret) * (1 + zamOran/100)) })));
                    setZamModal(false); alert("Zam İşlendi!");
                }
            };

            const borclandir = () => {
                const ucret = year === 2026 ? m.ucret2026 : m.ucret2025;
                if(!ucret) return alert("Ücret 0 görünüyor, önce mükellef kartını güncelle.");
                const rec = { id: Date.now(), mukellefId: parseInt(selectedMId), tarih: new Date().toLocaleDateString(), tur: 'borc', aciklama: `${year} Ayı Tahakkuku`, tutar: ucret };
                setHareketler([rec, ...hareketler]);
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex justify-between items-center bg-slate-800 p-4 rounded-2xl border border-slate-700">
                        <div className="flex gap-2">
                            <button onClick={()=>setYear(2025)} className={`btn ${year===2025?'bg-blue-600':'bg-slate-700'}`}>2025</button>
                            <button onClick={()=>setYear(2026)} className={`btn ${year===2026?'bg-blue-600':'bg-slate-700'}`}>2026</button>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={()=>setZamModal(true)} className="btn bg-purple-600 text-white"><i className="fas fa-magic mr-2"></i> Zam Robotu</button>
                        </div>
                    </div>
                    {zamModal && <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50"><div className="bg-slate-800 p-8 rounded-2xl w-96 border border-purple-500"><h3 className="text-white font-bold mb-4">Otomatik Zam</h3><input type="number" className="input-dark mb-4 text-center text-xl font-bold" value={zamOran} onChange={e=>setZamOran(e.target.value)} /><button onClick={topluZam} className="btn bg-purple-600 w-full">Uygula</button><button onClick={()=>setZamModal(false)} className="text-slate-400 mt-4 w-full">İptal</button></div></div>}
                    <div className="glass-panel p-6 rounded-2xl flex gap-4 items-center">
                        <select className="input-dark flex-1" value={selectedMId} onChange={e=>setSelectedMId(parseInt(e.target.value))}>{mukellef.map(m=><option key={m.id} value={m.id}>{m.unvan}</option>)}</select>
                        <div className="text-right"><p className="text-xs text-slate-500">Seçili Yıl Ücreti</p><p className="font-bold text-emerald-400">{formatCurrency(year===2026 ? m?.ucret2026 : m?.ucret2025)}</p></div>
                        <button onClick={borclandir} className="btn btn-primary">Borçlandır</button>
                    </div>
                </div>
            );
        }

        function WhatsAppEngine({ mukellef, logs, sendApiMessage, getBakiye }) {
            const [selected, setSelected] = useState([]);
            const [msg, setMsg] = useState("");
            
            const toggle = (id) => setSelected(selected.includes(id) ? selected.filter(x=>x!==id) : [...selected, id]);
            const selectAll = () => setSelected(mukellef.map(m=>m.id));

            const send = async () => {
                if(selected.length === 0 || !msg) return alert("Seçim yapın!");
                for(let id of selected) {
                    const m = mukellef.find(x=>x.id===id);
                    if(m && m.tel) {
                        let finalMsg = msg.replace("[AD]", m.unvan).replace("[BORC]", formatCurrency(getBakiye(m.id)));
                        await sendApiMessage(m.tel, finalMsg);
                    }
                }
                alert("Gönderim Tamamlandı!"); setSelected([]);
            };

            return (
                <div className="grid grid-cols-12 gap-6 h-[80vh] fade-in">
                    <div className="col-span-4 bg-slate-800 rounded-2xl border border-slate-700 flex flex-col overflow-hidden">
                        <div className="p-4 border-b border-slate-700 flex justify-between">
                            <h3 className="font-bold text-white">Kişiler ({mukellef.length})</h3>
                            <button onClick={selectAll} className="text-xs text-emerald-400 underline">Hepsini Seç</button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar">
                            {mukellef.map(m => (
                                <div key={m.id} onClick={()=>toggle(m.id)} className={`p-2 rounded cursor-pointer text-xs flex justify-between ${selected.includes(m.id)?'bg-emerald-600 text-white':'hover:bg-slate-700 text-slate-300'}`}>
                                    <span className="truncate w-32">{m.unvan}</span>
                                    {getBakiye(m.id)>0 && <span className="bg-red-900 px-1 rounded">{formatCurrency(getBakiye(m.id))}</span>}
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="col-span-8 flex flex-col gap-4">
                        <div className="bg-slate-800 p-6 rounded-2xl border border-slate-700 flex-1 flex flex-col">
                            <textarea className="input-dark flex-1 resize-none mb-4" placeholder="Mesajınız... ( [AD] ve [BORC] yazarsanız otomatik değişir )" value={msg} onChange={e=>setMsg(e.target.value)}></textarea>
                            <button onClick={send} className="btn btn-wa w-full">GÖNDER ({selected.length})</button>
                        </div>
                        <div className="h-32 bg-slate-900 rounded-2xl border border-slate-800 p-4 overflow-y-auto custom-scrollbar">
                            <p className="text-xs text-slate-500 mb-2 font-bold uppercase">Log Kayıtları</p>
                            {logs.map(l => <div key={l.id} className="text-[10px] text-slate-400 border-b border-slate-800 py-1 flex justify-between"><span>{l.to}</span><span className="text-emerald-500">{l.status}</span></div>)}
                        </div>
                    </div>
                </div>
            );
        }

        function YedekPage({ data, setData }) { const download = () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: "application/json"})); a.download = `akca_yedek.json`; a.click(); }; const upload = (e) => { const r = new FileReader(); r.onload = (ev) => { setData(JSON.parse(ev.target.result)); alert("Yüklendi!"); }; r.readAsText(e.target.files[0]); }; return (<div className="grid grid-cols-2 gap-6 fade-in"><div className="glass-panel p-8 text-center rounded-xl hover:bg-white/5 cursor-pointer" onClick={download}><i className="fas fa-download text-4xl text-blue-500 mb-4"></i><h3>Yedeği İndir</h3></div><div className="glass-panel p-8 text-center rounded-xl hover:bg-white/5 cursor-pointer relative"><input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={upload} /><i className="fas fa-upload text-4xl text-green-500 mb-4"></i><h3>Yedek Yükle</h3></div></div>) }
        function StatCard({ title, val, icon, color }) { return (<div className="glass-panel p-6 rounded-2xl flex justify-between items-start"><div><p className="text-[10px] font-bold text-slate-500 uppercase">{title}</p><h3 className="text-2xl font-black text-white mt-1">{val}</h3></div><div className={`text-2xl ${color}`}><i className={`fas ${icon}`}></i></div></div>) }
        function MenuBtn({ icon, text, active, onClick, isSpecial, isBackup }) { return (<div onClick={onClick} className={`flex items-center gap-3 p-3 rounded-xl cursor-pointer transition mb-1 border-l-4 ${active ? (isSpecial ? 'bg-emerald-600 text-white border-emerald-400' : 'bg-blue-600 text-white border-blue-400') : 'text-slate-400 hover:bg-slate-800 hover:text-white border-transparent'}`}><i className={`fas ${icon} w-6 text-center`}></i><span className="text-xs font-bold uppercase italic tracking-tight">{text}</span></div>) }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
