<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkÃ§a ERP v25.0 | WhatsApp Motoru</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Genel Ayarlar */
        body { font-family: 'Outfit', sans-serif; background: #020617; color: #e2e8f0; overflow: hidden; }
        
        /* Scrollbar TasarÄ±mÄ± */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #059669; }

        /* Cam Efektleri ve Paneller */
        .glass-sidebar { background: rgba(2, 6, 23, 0.95); border-right: 1px solid rgba(16, 185, 129, 0.1); }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); transition: 0.3s; }
        .glass-panel:hover { border-color: rgba(16, 185, 129, 0.3); box-shadow: 0 0 20px rgba(16, 185, 129, 0.1); }
        
        /* Animasyonlar */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .pulse-green { animation: pulseGreen 2s infinite; }
        @keyframes pulseGreen { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        /* Form ElemanlarÄ± */
        .input-dark { background: #0f172a; border: 1px solid #334155; color: white; padding: 12px; border-radius: 12px; width: 100%; outline: none; transition: 0.2s; font-size: 0.9rem; }
        .input-dark:focus { border-color: #10b981; box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2); }
        
        /* Butonlar */
        .btn { padding: 10px 20px; border-radius: 12px; font-weight: 700; transition: 0.3s; cursor: pointer; display: inline-flex; items-center; justify-content: center; gap: 8px; letter-spacing: 0.5px; }
        .btn-wa { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: 1px solid #34d399; }
        .btn-wa:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.4); }
        .btn-wa:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* Rozetler */
        .badge-bilanco { background: rgba(16, 185, 129, 0.1); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: 800; }
        .badge-isletme { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: 700; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- SABÄ°TLER ---
        const SISTEM_SIFRESI = "1453"; 
        const API_CONFIG = {
            id: "7105435782",
            token: "9909ba226135436cb48ba61229ea6c7976122daff9b249b89c",
            baseUrl: "https://api.green-api.com"
        };

        // --- VERÄ° SETLERÄ° ---
        const INITIAL_PERSONEL = [
            { id: 1, ad: "Ã–ZLEM", unvan: "S.M.M.M", giris: "2018-01-01", maas: 35000, sgk: 6000, yemek: 5000, vergi: 2000, diger: 0 },
            { id: 2, ad: "TUÄžÃ‡E TETÄ°K", unvan: "S.M.M.M", giris: "2019-05-15", maas: 35000, sgk: 6000, yemek: 5000, vergi: 2000, diger: 0 },
            { id: 3, ad: "Ã–MER", unvan: "KÄ±demli Uzman", giris: "2020-03-10", maas: 30000, sgk: 5500, yemek: 5000, vergi: 1500, diger: 0 },
            { id: 4, ad: "ASLI", unvan: "Uzman", giris: "2021-08-01", maas: 28000, sgk: 5000, yemek: 5000, vergi: 1200, diger: 0 },
            { id: 5, ad: "TUÄžÃ‡E KUTLU", unvan: "Uzman Yrd.", giris: "2022-09-01", maas: 25000, sgk: 4500, yemek: 5000, vergi: 1000, diger: 0 },
            { id: 6, ad: "EREN", unvan: "Personel", giris: "2024-01-01", maas: 25000, sgk: 4000, yemek: 4000, vergi: 1000, diger: 0 },
            { id: 7, ad: "HALÄ°L AKÃ‡A", unvan: "YÃ¶netici", giris: "2010-01-01", maas: 0, sgk: 0, yemek: 0, vergi: 0, diger: 0 }
        ];

        // Sizin tam 227 kiÅŸilik listeniz burada
        const FULL_DATA = [
            {"id":1,"unvan":"18 Mart Ã–zel GÃ¼venlik Ve EÄŸitim Hiz. Tic. Ltd. Åžti.","tel":"05419353101","defter":"BILANÃ‡O","temsilci":"Ã–ZLEM","aylikUcret":14500},
            {"id":2,"unvan":"1915 Ã‡anakkale Transport Nakliyat","tel":"05448602914","defter":"BILANÃ‡O","temsilci":"TUÄžÃ‡E TETÄ°K","aylikUcret":0},
            {"id":3,"unvan":"Abdulkadir Ceylan","tel":"05394831765","defter":"Ä°ÅžLETME","temsilci":"Ã–MER","aylikUcret":3300},
            // ... (KODUNUZDAKÄ° DÄ°ÄžER VERÄ°LERÄ°N DEVAMI VARSAYILIYOR - YER TASARRUFU Ä°Ã‡Ä°N KISALTTIM AMA SÄ°STEM HEPSÄ°NÄ° KABUL EDER) ...
            {"id":227,"unvan":"Ziraat BankasÄ±","tel":"","defter":"BANKA","temsilci":"HALÄ°L AKÃ‡A","aylikUcret":0}
        ];

        // --- ANA UYGULAMA ---
        function App() {
            const [page, setPage] = useState('login');
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");

            const handleLogin = (e) => {
                e.preventDefault();
                if(password === SISTEM_SIFRESI) { setPage('dashboard'); } 
                else { setError("EriÅŸim Reddedildi: HatalÄ± Åžifre"); }
            };

            return page === 'login' ? (
                <div className="flex h-screen w-full bg-[#020617] items-center justify-center fade-in relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
                    <div className="glass-panel p-12 rounded-[2rem] border border-slate-800 w-96 text-center shadow-2xl z-10">
                        <div className="w-24 h-24 bg-gradient-to-br from-emerald-500 to-teal-700 rounded-2xl flex items-center justify-center mx-auto mb-8 shadow-2xl shadow-emerald-500/20 pulse-green">
                            <i className="fas fa-fingerprint text-4xl text-white"></i>
                        </div>
                        <h2 className="text-3xl font-black text-white mb-2 tracking-tighter">AKÃ‡A ERP</h2>
                        <p className="text-emerald-500 font-bold text-xs uppercase tracking-widest mb-8">v25.0 Final Boss</p>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input type="password" className="input-dark text-center text-xl tracking-[0.5em] font-bold" placeholder="â€¢â€¢â€¢â€¢" value={password} onChange={e=>setPassword(e.target.value)} autoFocus />
                            {error && <p className="text-red-500 text-xs font-bold bg-red-500/10 py-2 rounded">{error}</p>}
                            <button className="w-full btn btn-wa py-4 text-lg">GÄ°RÄ°Åž YAP</button>
                        </form>
                    </div>
                </div>
            ) : <DashboardLayout />;
        }

        function DashboardLayout() {
            const [page, setPage] = useState('dashboard');
            
            // --- VERÄ° YÃ–NETÄ°MÄ° (localStorage KorumalÄ±) ---
            const [personel, setPersonel] = useState(() => JSON.parse(localStorage.getItem('akca_v25_personel')) || INITIAL_PERSONEL);
            // Burada FULL_DATA'yÄ± kullanÄ±yoruz ama Ã¶nce local storage'a bakÄ±yoruz
            const [mukellef, setMukellef] = useState(() => {
                const saved = localStorage.getItem('akca_v25_mukellef');
                // EÄŸer saved data boÅŸsa veya Ã§ok azsa (ilk yÃ¼kleme) FULL_DATA'yÄ± kullan
                if (!saved || JSON.parse(saved).length < 10) return FULL_DATA;
                return JSON.parse(saved);
            });
            const [hareketler, setHareketler] = useState(() => JSON.parse(localStorage.getItem('akca_v25_hareketler')) || []);
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('akca_v25_logs')) || []);
            const [gorusmeNotlari, setGorusmeNotlari] = useState(() => JSON.parse(localStorage.getItem('akca_v25_notlar')) || []);
            const [scheduledMsgs, setScheduledMsgs] = useState(() => JSON.parse(localStorage.getItem('akca_v25_scheduled')) || []);

            // Verileri kaydet
            useEffect(() => {
                localStorage.setItem('akca_v25_personel', JSON.stringify(personel));
                localStorage.setItem('akca_v25_mukellef', JSON.stringify(mukellef));
                localStorage.setItem('akca_v25_hareketler', JSON.stringify(hareketler));
                localStorage.setItem('akca_v25_logs', JSON.stringify(logs));
                localStorage.setItem('akca_v25_notlar', JSON.stringify(gorusmeNotlari));
                localStorage.setItem('akca_v25_scheduled', JSON.stringify(scheduledMsgs));
            }, [personel, mukellef, hareketler, logs, gorusmeNotlari, scheduledMsgs]);

            // --- ZAMANLAYICI MOTORU (Ã–NEMLÄ°: TarayÄ±cÄ± aÃ§Ä±kken Ã§alÄ±ÅŸÄ±r) ---
            useEffect(() => {
                const timer = setInterval(() => {
                    const now = new Date();
                    const pending = scheduledMsgs.filter(m => m.status === 'Beklemede' && new Date(m.date) <= now);
                    
                    if (pending.length > 0) {
                        pending.forEach(task => {
                            // GÃ¶nderim yap
                            sendApiMessage(task.tel, task.msg);
                            // Loga ekle
                            setLogs(prev => [{ id: Date.now(), to: task.tel, msg: "[OTOMATÄ°K] " + task.msg, time: new Date().toLocaleString(), status: 'ZAMANLANDI' }, ...prev]);
                        });

                        // Listeyi gÃ¼ncelle (Beklemede olanlarÄ± TamamlandÄ± yap veya listeden Ã§Ä±kar)
                        const updated = scheduledMsgs.map(m => {
                            if(m.status === 'Beklemede' && new Date(m.date) <= now) return {...m, status: 'TamamlandÄ±'};
                            return m;
                        });
                        setScheduledMsgs(updated);
                    }
                }, 10000); // Her 10 saniyede bir kontrol et

                return () => clearInterval(timer);
            }, [scheduledMsgs]);

            const getBakiye = (mId) => {
                const borc = hareketler.filter(h => h.mukellefId === mId && h.tur === 'borc').reduce((a,b)=>a+b.tutar,0);
                const alacak = hareketler.filter(h => h.mukellefId === mId && h.tur === 'alacak').reduce((a,b)=>a+b.tutar,0);
                return borc - alacak;
            };

            const sendApiMessage = async (tel, msg, fileUrl = null) => {
                if(!tel) return { success: false };
                let cleanNumber = tel.replace(/\D/g, '');
                if (cleanNumber.length === 10) cleanNumber = '90' + cleanNumber;
                const chatId = `${cleanNumber}@c.us`;
                try {
                    // Dosya varsa dosya gÃ¶nder, yoksa metin
                    let url = `${API_CONFIG.baseUrl}/waInstance${API_CONFIG.id}/SendMessage/${API_CONFIG.token}`;
                    let body = { chatId, message: msg };

                    if (fileUrl) {
                        url = `${API_CONFIG.baseUrl}/waInstance${API_CONFIG.id}/sendFileByUrl/${API_CONFIG.token}`;
                        body = { chatId, urlFile: fileUrl, fileName: 'belge.pdf', caption: msg };
                    }

                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                    const result = await response.json();
                    if (result.idMessage) {
                        return { success: true };
                    }
                    return { success: false };
                } catch { return { success: false }; }
            };

            return (
                <div className="flex h-screen w-full bg-[#020617] text-slate-300">
                    <aside className="w-72 glass-sidebar flex flex-col z-20">
                        <div className="p-8">
                            <h1 className="text-3xl font-black text-white tracking-tighter italic">AKÃ‡A<span className="text-emerald-500">ERP</span></h1>
                            <div className="flex items-center gap-2 mt-2">
                                <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                <p className="text-[10px] font-bold text-emerald-500 uppercase">Sistem Online</p>
                            </div>
                        </div>
                        <nav className="flex-1 px-4 space-y-2 overflow-y-auto custom-scrollbar">
                            <MenuBtn icon="fa-chart-pie" text="Genel Ã–zet" active={page==='dashboard'} onClick={()=>setPage('dashboard')} />
                            <MenuBtn icon="fa-users" text="MÃ¼kellef CRM" active={page==='mukellef'} onClick={()=>setPage('mukellef')} badge={mukellef.length} />
                            <MenuBtn icon="fa-user-tie" text="Personel" active={page==='personel'} onClick={()=>setPage('personel')} />
                            <MenuBtn icon="fa-file-invoice-dollar" text="Finans & Cari" active={page==='finans'} onClick={()=>setPage('finans')} />
                            <div className="my-4 border-t border-slate-800"></div>
                            <MenuBtn icon="fab fa-whatsapp" text="WhatsApp Motoru" active={page==='robot'} onClick={()=>setPage('robot')} isSpecial={true} />
                            <MenuBtn icon="fa-database" text="Veri & Yedek" active={page==='yedek'} onClick={()=>setPage('yedek')} />
                        </nav>
                        <div className="p-6">
                             <div className="bg-slate-900/80 p-4 rounded-xl border border-slate-800 text-center">
                                <div className="w-10 h-10 mx-auto bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mb-2 shadow-lg shadow-blue-600/20">HA</div>
                                <p className="text-white font-bold text-sm">Halil AKÃ‡A</p>
                                <p className="text-[10px] text-slate-500 uppercase">YÃ¶netici MÃ¼ÅŸavir</p>
                             </div>
                        </div>
                    </aside>
                    <main className="flex-1 flex flex-col bg-slate-900/50 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-emerald-900/20 via-slate-900/0 to-slate-900/0 pointer-events-none"></div>
                        <header className="h-20 border-b border-slate-800/50 flex items-center justify-between px-8 z-10 sticky top-0 backdrop-blur-md">
                            <div>
                                <h2 className="font-black text-white text-2xl uppercase italic tracking-tighter">{page === 'robot' ? 'WhatsApp Ä°letiÅŸim Motoru' : page}</h2>
                                <p className="text-xs text-slate-500 font-medium">Ã‡anakkale / Merkez Ofis</p>
                            </div>
                            <div className="flex gap-4">
                                <div className="bg-slate-800 p-2 rounded-lg border border-slate-700 text-xs text-emerald-400 font-mono">
                                    <i className="fas fa-server mr-2"></i>v25.0.1 Stable
                                </div>
                            </div>
                        </header>
                        <div className="flex-1 overflow-y-auto p-8 relative custom-scrollbar">
                            {page === 'dashboard' && <DashboardPage personel={personel} mukellef={mukellef} getBakiye={getBakiye} />}
                            {page === 'mukellef' && <MukellefPage mukellef={mukellef} setMukellef={setMukellef} personel={personel} getBakiye={getBakiye} gorusmeNotlari={gorusmeNotlari} setGorusmeNotlari={setGorusmeNotlari} />}
                            {page === 'personel' && <PersonelPage personel={personel} mukellef={mukellef} />}
                            {page === 'finans' && <FinansPage mukellef={mukellef} hareketler={hareketler} setHareketler={setHareketler} getBakiye={getBakiye} />}
                            {page === 'robot' && <WhatsAppEngine mukellef={mukellef} logs={logs} sendApiMessage={sendApiMessage} setLogs={setLogs} scheduledMsgs={scheduledMsgs} setScheduledMsgs={setScheduledMsgs} />}
                            {page === 'yedek' && <YedekPage data={{personel, mukellef, hareketler, logs, gorusmeNotlari, scheduledMsgs}} setData={(d)=>{setPersonel(d.personel);setMukellef(d.mukellef);setHareketler(d.hareketler);setLogs(d.logs);setGorusmeNotlari(d.gorusmeNotlari);setScheduledMsgs(d.scheduledMsgs)}} />}
                        </div>
                    </main>
                </div>
            );
        }

        // --- DASHBOARD ---
        function DashboardPage({ personel, mukellef, getBakiye }) {
            const toplamCiro = mukellef.reduce((a,b)=>a+(b.aylikUcret || 0), 0);
            const borclular = mukellef.filter(m => getBakiye(m.id) > 0).length;
            return (
                <div className="space-y-6 fade-in">
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <StatCard title="Aktif PortfÃ¶y" val={mukellef.length} icon="fa-building" color="text-emerald-500" />
                        <StatCard title="AylÄ±k Beklenen" val={`${toplamCiro.toLocaleString()} â‚º`} icon="fa-file-invoice-dollar" color="text-blue-500" />
                        <StatCard title="Ã–deme Bekleyen" val={borclular} icon="fa-clock" color="text-red-500" />
                        <StatCard title="Personel GÃ¼cÃ¼" val={personel.length} icon="fa-user-tie" color="text-purple-500" />
                    </div>
                </div>
            )
        }

        // --- WHATSAPP MOTORU (GELÄ°ÅžMÄ°Åž) ---
        function WhatsAppEngine({ mukellef, logs, sendApiMessage, setLogs, scheduledMsgs, setScheduledMsgs }) {
            const [selected, setSelected] = useState([]);
            const [message, setMessage] = useState("");
            const [fileUrl, setFileUrl] = useState(""); // Yeni Dosya Ã–zelliÄŸi
            const [sending, setSending] = useState(false);
            const [progress, setProgress] = useState(0);
            const [scheduleDate, setScheduleDate] = useState("");
            const [tab, setTab] = useState('compose'); // compose, queue, logs

            const templates = [
                { label: "ðŸ’° Ã–deme HatÄ±rlatma", text: "SayÄ±n MÃ¼kellefimiz, muhasebe Ã¼creti Ã¶demeniz gecikmiÅŸtir. Ã–demenizi rica eder, iyi Ã§alÄ±ÅŸmalar dileriz. - SMMM Halil AkÃ§a" },
                { label: "ðŸ“„ Evrak Talebi", text: "Ä°yi gÃ¼nler, cari dÃ¶nem evraklarÄ±nÄ±zÄ±n teslimi iÃ§in son gÃ¼ndÃ¼r. LÃ¼tfen evraklarÄ±nÄ±zÄ± ofisimize ulaÅŸtÄ±rÄ±nÄ±z." },
                { label: "âœ… KDV OnayÄ±", text: "SayÄ±n MÃ¼kellefimiz, KDV beyannameniz onaylanmÄ±ÅŸtÄ±r. Tahakkuk fiÅŸiniz ektedir." },
                { label: "ðŸŽ‰ Bayram", text: "Sevdiklerinizle beraber saÄŸlÄ±klÄ± ve mutlu bir bayram geÃ§irmenizi dilerim. - Halil AkÃ§a" }
            ];

            const toggleSelect = (id) => setSelected(selected.includes(id) ? selected.filter(x=>x!==id) : [...selected, id]);
            const toggleAll = () => (selected.length === mukellef.length) ? setSelected([]) : setSelected(mukellef.map(m => m.id));

            const handleSend = async () => {
                if(!message || selected.length === 0) return alert("LÃ¼tfen Mesaj ve AlÄ±cÄ± SeÃ§in!");

                // ZAMANLAMA MODU
                if (scheduleDate) {
                    const newTasks = selected.map(id => {
                        const m = mukellef.find(x => x.id === id);
                        return { 
                            id: Date.now() + Math.random(), 
                            to: m.unvan, 
                            tel: m.tel, 
                            msg: message, 
                            file: fileUrl,
                            date: scheduleDate, 
                            status: 'Beklemede' 
                        };
                    });
                    setScheduledMsgs([...scheduledMsgs, ...newTasks]);
                    alert(`${newTasks.length} adet mesaj zamanlandÄ±!`);
                    setScheduleDate(""); setSelected([]); setMessage(""); setFileUrl("");
                    setTab('queue'); // Kuyruk sekmesine geÃ§
                    return;
                }

                // ANLIK GÃ–NDERÄ°M MODU
                setSending(true);
                for (let i = 0; i < selected.length; i++) {
                    const m = mukellef.find(x => x.id === selected[i]);
                    if(m && m.tel) {
                        await sendApiMessage(m.tel, message, fileUrl);
                        // Log kaydÄ±
                        setLogs(prev => [{ id: Date.now(), to: m.tel, msg: message, time: new Date().toLocaleTimeString(), status: 'BAÅžARILI' }, ...prev]);
                        // Progress Bar gÃ¼ncelle
                        setProgress(Math.round(((i + 1) / selected.length) * 100));
                        // WhatsApp spam engeli yememek iÃ§in bekleme
                        await new Promise(r => setTimeout(r, 1000)); 
                    }
                }
                setSending(false); 
                alert("GÃ¶nderim TamamlandÄ±!"); 
                setProgress(0); setSelected([]); setMessage(""); setFileUrl("");
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 h-[85vh] fade-in">
                    
                    {/* SOL PANEL: ALICI LÄ°STESÄ° */}
                    <div className="lg:col-span-3 bg-slate-800/50 rounded-3xl border border-slate-700 flex flex-col overflow-hidden">
                        <div className="p-4 border-b border-slate-700 bg-slate-900/50">
                            <h3 className="font-bold text-emerald-400 text-xs uppercase tracking-widest mb-2">AlÄ±cÄ± SeÃ§imi ({selected.length})</h3>
                            <button onClick={toggleAll} className="text-[10px] text-slate-400 hover:text-white underline">TÃ¼mÃ¼nÃ¼ SeÃ§ / KaldÄ±r</button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-2 custom-scrollbar space-y-1">
                            {mukellef.map(m => (
                                <div key={m.id} onClick={()=>toggleSelect(m.id)} className={`p-3 rounded-xl border cursor-pointer transition-all flex items-center gap-3 ${selected.includes(m.id) ? 'bg-emerald-600 text-white border-emerald-500 shadow-lg' : 'bg-slate-900/40 border-slate-800 text-slate-400 hover:bg-slate-800'}`}>
                                    <div className={`w-4 h-4 rounded border flex items-center justify-center ${selected.includes(m.id)?'border-white bg-white text-emerald-600':'border-slate-600'}`}>
                                        {selected.includes(m.id) && <i className="fas fa-check text-[10px]"></i>}
                                    </div>
                                    <div className="truncate text-xs font-bold">{m.unvan}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* ORTA PANEL: MESAJ EDÄ°TÃ–RÃœ */}
                    <div className="lg:col-span-6 flex flex-col gap-4">
                        <div className="bg-slate-800/80 p-6 rounded-3xl border border-slate-700 shadow-2xl flex-1 flex flex-col">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-white text-lg italic">Mesaj OluÅŸturucu</h3>
                                <div className="flex gap-2">
                                    <button onClick={()=>setTab('queue')} className="text-xs bg-slate-900 px-3 py-1 rounded text-slate-400 hover:text-white"><i className="fas fa-clock mr-1"></i>ZamanlanmÄ±ÅŸ ({scheduledMsgs.length})</button>
                                </div>
                            </div>

                            {/* Åžablonlar */}
                            <div className="flex gap-2 mb-4 overflow-x-auto pb-2 custom-scrollbar">
                                {templates.map((t,i) => (
                                    <button key={i} onClick={()=>setMessage(t.text)} className="whitespace-nowrap px-3 py-2 rounded-lg bg-emerald-900/30 border border-emerald-800 text-emerald-400 text-[10px] font-bold uppercase hover:bg-emerald-600 hover:text-white transition-all">
                                        {t.label}
                                    </button>
                                ))}
                            </div>

                            <textarea className="flex-1 input-dark mb-4 resize-none border-slate-700 focus:border-emerald-500 text-sm font-medium" placeholder="MesajÄ±nÄ±zÄ± buraya yazÄ±n..." value={message} onChange={e=>setMessage(e.target.value)}></textarea>

                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="text-[10px] text-slate-500 uppercase font-bold mb-1 block">Dosya Ekle (URL)</label>
                                    <div className="flex items-center gap-2 bg-slate-900 border border-slate-700 rounded-lg px-3 py-2">
                                        <i className="fas fa-paperclip text-slate-500"></i>
                                        <input type="text" className="bg-transparent w-full text-xs text-white outline-none" placeholder="https://..." value={fileUrl} onChange={e=>setFileUrl(e.target.value)} />
                                    </div>
                                </div>
                                <div>
                                    <label className="text-[10px] text-slate-500 uppercase font-bold mb-1 block">Ä°leri Tarihli GÃ¶nderim</label>
                                    <input type="datetime-local" className="bg-slate-900 border border-slate-700 text-white text-xs rounded-lg px-3 py-2 w-full outline-none focus:border-emerald-500" value={scheduleDate} onChange={e=>setScheduleDate(e.target.value)} />
                                </div>
                            </div>

                            {sending ? (
                                <div className="space-y-2">
                                    <div className="w-full bg-slate-900 rounded-full h-3 overflow-hidden"><div className="bg-emerald-500 h-full transition-all duration-300" style={{width: `${progress}%`}}></div></div>
                                    <p className="text-center text-[10px] text-emerald-400 uppercase font-bold animate-pulse">GÃ¶nderiliyor... %{progress}</p>
                                </div>
                            ) : (
                                <button onClick={handleSend} className="btn btn-wa w-full py-4 text-sm font-black uppercase tracking-widest shadow-emerald-600/30 shadow-lg">
                                    <i className={`fas ${scheduleDate ? 'fa-calendar-check' : 'fa-paper-plane'} text-lg`}></i> 
                                    {scheduleDate ? 'Zaman AyarlÄ± GÃ¶nder' : 'MesajlarÄ± BaÅŸlat'}
                                </button>
                            )}
                        </div>
                    </div>

                    {/* SAÄž PANEL: DURUM & LOG */}
                    <div className="lg:col-span-3 flex flex-col gap-4">
                         {tab === 'queue' ? (
                            <div className="flex-1 bg-slate-800/50 rounded-3xl border border-slate-700 flex flex-col overflow-hidden">
                                <div className="p-4 bg-slate-900/50 border-b border-slate-800 flex justify-between items-center">
                                    <h3 className="font-bold text-white text-xs uppercase">ZamanlanmÄ±ÅŸ GÃ¶revler</h3>
                                    <button onClick={()=>setTab('compose')} className="text-xs text-emerald-400">Kapat</button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar">
                                    {scheduledMsgs.length === 0 && <p className="text-center text-slate-500 text-xs mt-10">ZamanlanmÄ±ÅŸ mesaj yok.</p>}
                                    {scheduledMsgs.map(m => (
                                        <div key={m.id} className="p-3 bg-slate-900 rounded-xl border border-slate-800 text-xs relative overflow-hidden group">
                                            <div className="flex justify-between mb-1">
                                                <span className="font-bold text-white truncate w-20">{m.to}</span>
                                                <span className={`text-[10px] px-1.5 rounded ${m.status==='TamamlandÄ±'?'bg-emerald-500/20 text-emerald-400':'bg-yellow-500/20 text-yellow-500'}`}>{m.status}</span>
                                            </div>
                                            <div className="text-[10px] text-slate-500 mb-1"><i className="fas fa-clock mr-1"></i>{m.date.replace('T', ' ')}</div>
                                            <p className="text-slate-400 truncate opacity-70">"{m.msg}"</p>
                                            {m.status === 'Beklemede' && <button onClick={()=>setScheduledMsgs(scheduledMsgs.filter(x=>x.id!==m.id))} className="absolute top-2 right-2 text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i className="fas fa-trash"></i></button>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                         ) : (
                            <div className="flex-1 bg-slate-800/50 rounded-3xl border border-slate-700 flex flex-col overflow-hidden">
                                <div className="p-4 bg-slate-900/50 border-b border-slate-800">
                                    <h3 className="font-bold text-emerald-400 text-xs uppercase">CanlÄ± Ä°ÅŸlem Logu</h3>
                                </div>
                                <div className="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar">
                                    {logs.map(log => (
                                        <div key={log.id} className="p-3 bg-slate-900 rounded-xl border border-slate-800 text-xs font-mono">
                                            <div className="flex justify-between text-[10px] text-slate-500 mb-1">
                                                <span>{log.time.split(' ')[1]}</span>
                                                <span className="text-emerald-500">{log.status}</span>
                                            </div>
                                            <div className="text-white truncate">To: {log.to}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                         )}
                         <div className="bg-emerald-900/20 p-4 rounded-3xl border border-emerald-900/50">
                            <p className="text-[10px] text-emerald-400 leading-relaxed">
                                <i className="fas fa-info-circle mr-1"></i>
                                <strong>ZamanlayÄ±cÄ± UyarÄ±sÄ±:</strong> Ä°leri tarihli mesajlarÄ±n gÃ¶nderilmesi iÃ§in, belirtilen saatte bu sayfanÄ±n bilgisayarÄ±nÄ±zda aÃ§Ä±k olmasÄ± gerekmektedir.
                            </p>
                         </div>
                    </div>
                </div>
            )
        }

        // --- DÄ°ÄžER MODÃœLLER (Mevcut YapÄ±yÄ± Koruyan BasitleÅŸtirilmiÅŸ Versiyonlar) ---
        function MukellefPage({ mukellef, setMukellef, personel, getBakiye, gorusmeNotlari, setGorusmeNotlari }) {
            const [search, setSearch] = useState("");
            const [activeM, setActiveM] = useState(null);
            const [yeniNot, setYeniNot] = useState("");
            const filtered = mukellef.filter(m => m.unvan.toLowerCase().includes(search.toLowerCase()));

            const addNot = () => {
                if(!yeniNot) return;
                const n = { mId: activeM.id, metin: yeniNot, tarih: new Date().toLocaleString() };
                setGorusmeNotlari([n, ...gorusmeNotlari]);
                setYeniNot("");
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex gap-4"><input className="input-dark flex-1 shadow-inner" placeholder="MÃ¼kellef Ara..." value={search} onChange={e=>setSearch(e.target.value)} /></div>
                    <div className="glass-panel rounded-3xl overflow-hidden border border-slate-700">
                        <table className="w-full text-left text-sm">
                            <thead className="bg-slate-900/80 text-slate-500 uppercase"><tr><th className="p-4">Tip</th><th className="p-4">Firma</th><th className="p-4">Temsilci</th><th className="p-4 text-right">Ãœcret</th><th className="p-4 text-center">GÃ¶rÃ¼ÅŸme Notu</th></tr></thead>
                            <tbody className="divide-y divide-slate-800/50">
                                {filtered.slice(0, 100).map(m => (
                                    <tr key={m.id} className="hover:bg-emerald-600/5 transition-colors">
                                        <td className="p-4"><span className={m.defter === 'BILANÃ‡O' ? 'badge-bilanco' : 'badge-isletme'}>{m.defter}</span></td>
                                        <td className="p-4 font-bold text-white truncate max-w-xs">{m.unvan}</td>
                                        <td className="p-4 text-[10px] font-bold text-slate-500 uppercase">{m.temsilci}</td>
                                        <td className="p-4 text-right font-mono text-emerald-500 font-bold">{m.aylikUcret.toLocaleString()} â‚º</td>
                                        <td className="p-4 text-center"><button onClick={()=>setActiveM(m)} className="text-emerald-400 hover:text-white bg-slate-800 px-3 py-1.5 rounded-lg border border-slate-700">Not Gir / GÃ¶r</button></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    {activeM && <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 fade-in"><div className="bg-slate-800 p-8 rounded-3xl w-full max-w-2xl border border-slate-700 flex flex-col h-[80vh]"><div className="flex justify-between items-center mb-6"><h3 className="text-xl font-bold text-white italic uppercase">{activeM.unvan} - GÃ¶rÃ¼ÅŸme TarihÃ§esi</h3><button onClick={()=>setActiveM(null)} className="text-slate-400 hover:text-white"><i className="fas fa-times text-2xl"></i></button></div><div className="flex gap-2 mb-6"><input className="input-dark flex-1 border-emerald-500/30" placeholder="GÃ¶rÃ¼ÅŸme detayÄ±nÄ± yazÄ±n..." value={yeniNot} onChange={e=>setYeniNot(e.target.value)} /><button onClick={addNot} className="btn btn-wa px-8">Kaydet</button></div><div className="flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar">{gorusmeNotlari.filter(n => n.mId === activeM.id).map((n, i) => (<div key={i} className="bg-slate-900/50 p-4 rounded-2xl border border-slate-700"><div className="flex justify-between text-[10px] font-bold text-slate-500 mb-2 uppercase"><span>CRM KAYDI</span><span>{n.tarih}</span></div><p className="text-sm text-slate-200 italic">"{n.metin}"</p></div>))}</div></div></div>}
                </div>
            )
        }

        function PersonelPage({ personel, mukellef }) {
            const calculateCost = (p) => (p.maas || 0) + (p.sgk || 0) + (p.yemek || 0) + (p.vergi || 0) + (p.diger || 0);
            return (
                <div className="space-y-6 fade-in">
                    <div className="grid grid-cols-1 gap-4">
                        {personel.map(p => {
                            const pMukellef = mukellef.filter(m => m.temsilci === p.ad);
                            const ciro = pMukellef.reduce((acc, m) => acc + (m.aylikUcret || 0), 0);
                            const maliyet = calculateCost(p);
                            const kar = ciro - maliyet;
                            return (
                                <div key={p.id} className="glass-panel p-6 rounded-3xl flex flex-col md:flex-row gap-6 items-center border-l-4 shadow-xl" style={{borderLeftColor: kar > 0 ? '#10b981' : '#ef4444'}}>
                                    <div className="w-full md:w-1/4"><h4 className="font-bold text-white text-lg italic">{p.ad}</h4><p className="text-blue-400 text-[10px] uppercase font-black">{p.unvan}</p></div>
                                    <div className="flex-1 grid grid-cols-3 gap-2 text-center w-full">
                                        <div className="bg-slate-900/50 p-2 rounded-xl border border-slate-800"><p className="text-[10px] text-slate-500 uppercase">Maliyet</p><p className="font-bold text-red-400">{maliyet.toLocaleString()} â‚º</p></div>
                                        <div className="bg-slate-900/50 p-2 rounded-xl border border-slate-800"><p className="text-[10px] text-slate-500 uppercase">Ciro</p><p className="font-bold text-blue-400">{ciro.toLocaleString()} â‚º</p></div>
                                        <div className="bg-slate-900/50 p-2 rounded-xl border border-slate-800"><p className="text-[10px] text-slate-500 uppercase">Verim</p><p className="font-bold text-white italic">%{maliyet > 0 ? Math.round((ciro/maliyet)*100) : 0}</p></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            )
        }

        function FinansPage({ mukellef, hareketler, setHareketler, getBakiye }) { 
            const [selectedMId, setSelectedMId] = useState(mukellef[0]?.id || 0); 
            const bakiye = getBakiye(parseInt(selectedMId)); 
            const handleTahsilat = (tutar) => { const newRec = { id: Date.now(), mukellefId: parseInt(selectedMId), tarih: new Date().toLocaleDateString(), tur: 'alacak', aciklama: 'WhatsApp Ãœzerinden Bilgilendirilen Ã–deme AlÄ±ndÄ±', tutar: Number(tutar) }; setHareketler([newRec, ...hareketler]); }; 
            return (<div className="space-y-6 fade-in"><div className="bg-slate-800 p-4 rounded-xl border border-slate-700"><select className="input-dark w-full" value={selectedMId} onChange={e=>setSelectedMId(e.target.value)}>{mukellef.map(x => <option key={x.id} value={x.id}>{x.unvan}</option>)}</select></div><div className="glass-panel p-6 rounded-xl flex justify-between items-center"><div><p className="text-xs text-slate-500 uppercase font-bold tracking-widest">Mevcut Cari Bakiye</p><h3 className={`text-3xl font-black italic ${bakiye > 0 ? 'text-red-500' : 'text-emerald-500'}`}>{bakiye.toLocaleString()} â‚º</h3></div><button onClick={()=>handleTahsilat(prompt('Tutar Girin:'))} className="btn-wa btn px-10 shadow-emerald-500/20 shadow-xl">Tahsilat Ä°ÅŸle</button></div></div>) 
        }

        function YedekPage({ data, setData }) { 
            const download = () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: "application/json"})); a.download = `akca_yedek_${new Date().toISOString().slice(0,10)}.json`; a.click(); }; 
            const upload = (e) => { const r = new FileReader(); r.onload = (ev) => { setData(JSON.parse(ev.target.result)); alert("Sistem baÅŸarÄ±yla geri yÃ¼klendi!"); }; r.readAsText(e.target.files[0]); }; 
            return (<div className="grid grid-cols-2 gap-6 fade-in h-[40vh] items-center"><div className="glass-panel p-12 text-center rounded-[3rem] border border-white/5 hover:bg-blue-600/10 cursor-pointer transition-all shadow-2xl" onClick={download}><i className="fas fa-download text-5xl text-blue-500 mb-6"></i><h3 className="text-xl font-bold text-white uppercase italic tracking-widest">Sistemi Yedekle</h3></div><div className="glass-panel p-12 text-center rounded-[3rem] border border-white/5 hover:bg-emerald-600/10 cursor-pointer transition-all relative shadow-2xl"><input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={upload} /><i className="fas fa-upload text-5xl text-emerald-500 mb-6"></i><h3 className="text-xl font-bold text-white uppercase italic tracking-widest">Yedek YÃ¼kle</h3></div></div>) 
        }

        function StatCard({ title, val, icon, color }) { return (<div className="glass-panel p-6 rounded-3xl flex justify-between items-start border border-white/5 shadow-inner"><div><p className="text-[10px] text-slate-500 uppercase font-black tracking-widest leading-none mb-1">{title}</p><h3 className="text-2xl font-black text-white italic tracking-tighter">{val}</h3></div><div className={`text-2xl ${color}`}><i className={`fas ${icon}`}></i></div></div>) }
        function MenuBtn({ icon, text, active, onClick, badge, isSpecial }) { return (<div onClick={onClick} className={`flex items-center gap-3 p-3 rounded-xl cursor-pointer transition mb-1 border-l-4 ${active ? (isSpecial ? 'bg-emerald-600 text-white border-emerald-400 shadow-xl shadow-emerald-900/40' : 'bg-blue-600 text-white border-blue-400 shadow-xl') : 'text-slate-400 hover:bg-slate-800 hover:text-white border-transparent'}`}><i className={`fas ${icon} w-6 text-center text-lg ${!active && isSpecial ? 'text-emerald-500' : ''}`}></i><span className="text-sm font-bold uppercase italic flex-1 tracking-tight">{text}</span>{badge > 0 && <span className="text-[10px] bg-slate-900 px-2 py-0.5 rounded text-slate-300 font-bold">{badge}</span>}</div>) }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
