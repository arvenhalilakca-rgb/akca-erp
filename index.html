<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKÃ‡A ERP 2026 v25 | Finansal RÃ¶ntgen</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Outfit', sans-serif; background: #020617; color: #e2e8f0; overflow: hidden; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
        .glass-sidebar { background: rgba(2, 6, 23, 0.95); border-right: 1px solid rgba(16, 185, 129, 0.1); }
        .glass-panel { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); transition: 0.3s; }
        .glass-panel:hover { border-color: rgba(16, 185, 129, 0.3); }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        .input-dark { background: #0f172a; border: 1px solid #334155; color: white; padding: 12px; border-radius: 12px; width: 100%; outline: none; transition: 0.2s; font-size: 0.9rem; }
        .input-dark:focus { border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        
        .btn { padding: 10px 20px; border-radius: 12px; font-weight: 700; transition: 0.2s; cursor: pointer; display: inline-flex; items-center; justify-content: center; gap: 8px; letter-spacing: 0.5px; }
        .btn-primary { background: #3b82f6; color: white; } .btn-primary:hover { background: #2563eb; }
        .btn-wa { background: linear-gradient(135deg, #10b981 0%, #047857 100%); color: white; border: 1px solid #34d399; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        
        .login-bg { background: radial-gradient(circle at center, #064e3b 0%, #020617 70%); }
        .glow-text { text-shadow: 0 0 30px rgba(16, 185, 129, 0.5); }
        .ai-panel { background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%); border: 1px solid rgba(124, 58, 237, 0.3); }
        
        /* YaÅŸlandÄ±rma Renkleri */
        .age-green { background: #10b981; }
        .age-yellow { background: #f59e0b; }
        .age-red { background: #ef4444; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const SISTEM_SIFRESI = "1717"; 
        const API_CONFIG = {
            id: "7105435782",
            token: "9909ba226135436cb48ba61229ea6c7976122daff9b249b89c",
            baseUrl: "https://api.green-api.com"
        };

        const INITIAL_PERSONEL = [
            { id: 1, ad: "Ã–ZLEM", unvan: "S.M.M.M", giris: "2018-01-01", maas: 35000, sgk: 6000, yemek: 5000, vergi: 2000, diger: 0 },
            { id: 2, ad: "TUÄžÃ‡E TETÄ°K", unvan: "S.M.M.M", giris: "2019-05-15", maas: 35000, sgk: 6000, yemek: 5000, vergi: 2000, diger: 0 },
            { id: 3, ad: "Ã–MER", unvan: "KÄ±demli Uzman", giris: "2020-03-10", maas: 30000, sgk: 5500, yemek: 5000, vergi: 1500, diger: 0 },
            { id: 4, ad: "ASLI", unvan: "Uzman", giris: "2021-08-01", maas: 28000, sgk: 5000, yemek: 5000, vergi: 1200, diger: 0 },
            { id: 5, ad: "TUÄžÃ‡E KUTLU", unvan: "Uzman Yrd.", giris: "2022-09-01", maas: 25000, sgk: 4500, yemek: 5000, vergi: 1000, diger: 0 },
            { id: 6, ad: "EREN", unvan: "Personel", giris: "2024-01-01", maas: 25000, sgk: 4000, yemek: 4000, vergi: 1000, diger: 0 },
            { id: 7, ad: "HALÄ°L AKÃ‡A", unvan: "YÃ¶netici", giris: "2010-01-01", maas: 0, sgk: 0, yemek: 0, vergi: 0, diger: 0 }
        ];

        const FULL_DATA = [
            {"id":1,"unvan":"18 Mart Ã–zel GÃ¼venlik Ve EÄŸitim Hiz. Tic. Ltd. Åžti.","tel":"05419353101","defter":"BILANÃ‡O","temsilci":"Ã–ZLEM","aylikUcret":14500,"durum":"Aktif"},
            {"id":227,"unvan":"Ziraat BankasÄ±","tel":"","defter":"BANKA","temsilci":"HALÄ°L AKÃ‡A","aylikUcret":0,"durum":"Aktif"}
        ];

        function App() {
            const [page, setPage] = useState('login');
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");

            const handleLogin = (e) => {
                e.preventDefault();
                if(password === SISTEM_SIFRESI) { setPage('dashboard'); } 
                else { setError("EriÅŸim Reddedildi: HatalÄ± Åžifre"); }
            };

            return page === 'login' ? (
                <div className="flex h-screen w-full bg-[#020617] items-center justify-center fade-in relative login-bg">
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
                    <div className="glass-panel p-12 rounded-[3rem] border border-emerald-900/50 w-96 text-center shadow-2xl z-10 relative">
                        <div className="w-24 h-24 bg-gradient-to-br from-emerald-500 to-teal-700 rounded-full flex items-center justify-center mx-auto mb-8 shadow-2xl shadow-emerald-500/40 animate-pulse">
                            <i className="fas fa-fingerprint text-4xl text-white"></i>
                        </div>
                        <h2 className="text-3xl font-black text-white mb-2 tracking-tighter glow-text">AKÃ‡A ERP</h2>
                        <p className="text-emerald-500 font-bold text-xs uppercase tracking-widest mb-8">v25 Financial X-Ray</p>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input type="password" className="input-dark text-center text-xl tracking-[0.5em] font-bold border-emerald-900/50 focus:border-emerald-500" placeholder="â€¢â€¢â€¢â€¢" value={password} onChange={e=>setPassword(e.target.value)} autoFocus />
                            {error && <p className="text-red-500 text-xs font-bold bg-red-500/10 py-2 rounded animate-bounce">{error}</p>}
                            <button className="w-full btn btn-wa py-4 text-lg shadow-emerald-500/20 shadow-xl">GÃœVENLÄ° GÄ°RÄ°Åž</button>
                        </form>
                    </div>
                </div>
            ) : <DashboardLayout />;
        }

        function DashboardLayout() {
            const [page, setPage] = useState('dashboard');
            
            const [personel, setPersonel] = useState(() => JSON.parse(localStorage.getItem('akca_v25_personel')) || INITIAL_PERSONEL);
            const [mukellef, setMukellef] = useState(() => {
                const saved = localStorage.getItem('akca_v25_mukellef');
                if (!saved || JSON.parse(saved).length < 227) {
                    return FULL_DATA.map(m => ({
                        ...m,
                        zorlukPuani: m.zorlukPuani || 5, 
                        odemeAliskanligi: m.odemeAliskanligi || 'Normal',
                        ucret2025: m.ucret2025 || m.aylikUcret,
                        ucret2026: m.ucret2026 || 0
                    }));
                }
                return JSON.parse(saved);
            });

            const [hareketler, setHareketler] = useState(() => JSON.parse(localStorage.getItem('akca_v25_hareketler')) || []);
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('akca_v25_logs')) || []);
            const [scheduledMsgs, setScheduledMsgs] = useState(() => JSON.parse(localStorage.getItem('akca_v25_scheduled')) || []);
            const [groups, setGroups] = useState(() => JSON.parse(localStorage.getItem('akca_v25_groups')) || []);
            const [botSettings, setBotSettings] = useState(() => JSON.parse(localStorage.getItem('akca_v18_bot')) || { limit: 5000, active: false });

            useEffect(() => {
                localStorage.setItem('akca_v25_personel', JSON.stringify(personel));
                localStorage.setItem('akca_v25_mukellef', JSON.stringify(mukellef));
                localStorage.setItem('akca_v25_hareketler', JSON.stringify(hareketler));
                localStorage.setItem('akca_v25_logs', JSON.stringify(logs));
                localStorage.setItem('akca_v25_scheduled', JSON.stringify(scheduledMsgs));
                localStorage.setItem('akca_v25_groups', JSON.stringify(groups));
                localStorage.setItem('akca_v18_bot', JSON.stringify(botSettings));
            }, [personel, mukellef, hareketler, logs, scheduledMsgs, groups, botSettings]);

            // --- YARDIMCI FONKSÄ°YONLAR ---
            const getBakiye = (mId) => {
                const borc = hareketler.filter(h => h.mukellefId === mId && h.tur === 'borc').reduce((a,b)=>a+b.tutar,0);
                const alacak = hareketler.filter(h => h.mukellefId === mId && h.tur === 'alacak').reduce((a,b)=>a+b.tutar,0);
                return borc - alacak;
            };

            const getDebtAge = (mId) => {
                const bakiye = getBakiye(mId);
                if (bakiye <= 0) return 0;
                // En son yapÄ±lan borÃ§ iÅŸleminin tarihini bul
                const lastBorc = hareketler.filter(h => h.mukellefId === mId && h.tur === 'borc')
                                            .sort((a,b) => new Date(b.tarih) - new Date(a.tarih))[0];
                if (!lastBorc) return 0;
                
                const diffTime = Math.abs(new Date() - new Date(lastBorc.tarih));
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                return diffDays;
            };

            const sendApiMessage = async (tel, msg, fileUrl = null) => {
                if(!tel) return { success: false };
                let cleanNumber = tel.replace(/\D/g, '');
                if (cleanNumber.length === 10) cleanNumber = '90' + cleanNumber;
                else if (cleanNumber.length === 11 && cleanNumber.startsWith('0')) cleanNumber = '90' + cleanNumber.substring(1);
                
                const chatId = `${cleanNumber}@c.us`;
                try {
                    let url = `${API_CONFIG.baseUrl}/waInstance${API_CONFIG.id}/SendMessage/${API_CONFIG.token}`;
                    let body = { chatId, message: msg };
                    if (fileUrl) {
                        url = `${API_CONFIG.baseUrl}/waInstance${API_CONFIG.id}/sendFileByUrl/${API_CONFIG.token}`;
                        body = { chatId, urlFile: fileUrl, fileName: 'belge.pdf', caption: msg };
                    }
                    const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                    const result = await response.json();
                    if (result.idMessage) {
                        if(!fileUrl) setLogs(prev => [{ id: Date.now(), to: cleanNumber, msg, time: new Date().toLocaleTimeString(), status: 'BAÅžARILI' }, ...prev]);
                        return { success: true };
                    }
                    return { success: false };
                } catch { return { success: false }; }
            };

            return (
                <div className="flex h-screen w-full bg-[#020617] text-slate-300">
                    <aside className="w-72 glass-sidebar flex flex-col z-20">
                        <div className="p-8">
                            <h1 className="text-2xl font-black text-white tracking-tight">AKÃ‡A ERP <span className="text-emerald-500">v25</span></h1>
                            <p className="text-[10px] font-bold text-slate-500 uppercase mt-1 flex items-center gap-2"><span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> Sistem Aktif</p>
                        </div>
                        <nav className="flex-1 px-4 space-y-1 overflow-y-auto custom-scrollbar">
                            <MenuBtn icon="fa-chart-pie" text="Genel Ã–zet" active={page==='dashboard'} onClick={()=>setPage('dashboard')} />
                            <MenuBtn icon="fa-users" text="MÃ¼kellef PortfÃ¶yÃ¼" active={page==='mukellef'} onClick={()=>setPage('mukellef')} />
                            <MenuBtn icon="fa-user-tie" text="Personel & Efor" active={page==='personel'} onClick={()=>setPage('personel')} />
                            <MenuBtn icon="fa-money-bill-transfer" text="Finans & YaÅŸlandÄ±rma" active={page==='finans'} onClick={()=>setPage('finans')} isSpecial={true} />
                            <MenuBtn icon="fab fa-whatsapp" text="WhatsApp Motoru" active={page==='robot'} onClick={()=>setPage('robot')} />
                            <MenuBtn icon="fa-shield-halved" text="Veri GÃ¼venliÄŸi" active={page==='yedek'} onClick={()=>setPage('yedek')} isBackup={true} />
                        </nav>
                        <div className="p-6 border-t border-slate-800">
                            <div className="bg-slate-900/50 p-3 rounded-xl border border-slate-800 text-center">
                                <p className="text-[10px] font-bold text-slate-500 uppercase">Aktif VeritabanÄ±</p>
                                <p className="text-sm font-black text-emerald-500">Ã‡ANAKKALE / MERKEZ</p>
                            </div>
                        </div>
                    </aside>
                    <main className="flex-1 flex flex-col bg-slate-900 relative overflow-hidden">
                        <header className="h-16 border-b border-slate-800 flex items-center justify-between px-8 bg-slate-900/90 z-10 sticky top-0 backdrop-blur-md">
                            <h2 className="font-bold text-white text-lg uppercase italic">{page === 'robot' ? 'WhatsApp Ä°letiÅŸim Motoru' : page}</h2>
                            <div className="flex items-center gap-4">
                                <div className="text-right"><p className="text-xs font-bold text-white leading-none">HALÄ°L AKÃ‡A</p><p className="text-[10px] text-slate-500 uppercase mt-1">Mali MÃ¼ÅŸavir</p></div>
                                <div className="w-10 h-10 bg-emerald-600 rounded-xl flex items-center justify-center text-white font-bold shadow-lg shadow-emerald-600/20">HA</div>
                            </div>
                        </header>
                        <div className="flex-1 overflow-y-auto p-8 relative custom-scrollbar">
                            {page === 'dashboard' && <DashboardPage personel={personel} mukellef={mukellef} getBakiye={getBakiye} getDebtAge={getDebtAge} />}
                            {page === 'mukellef' && <MukellefPage mukellef={mukellef} setMukellef={setMukellef} personel={personel} getBakiye={getBakiye} />}
                            {page === 'personel' && <PersonelPage personel={personel} setPersonel={setPersonel} mukellef={mukellef} setMukellef={setMukellef} />}
                            {page === 'finans' && <FinansPage mukellef={mukellef} hareketler={hareketler} setHareketler={setHareketler} getBakiye={getBakiye} getDebtAge={getDebtAge} />}
                            {page === 'robot' && <WhatsAppEngine mukellef={mukellef} logs={logs} sendApiMessage={sendApiMessage} setLogs={setLogs} scheduledMsgs={scheduledMsgs} setScheduledMsgs={setScheduledMsgs} groups={groups} setGroups={setGroups} getBakiye={getBakiye} botSettings={botSettings} setBotSettings={setBotSettings} getDebtAge={getDebtAge} />}
                            {page === 'yedek' && <YedekPage data={{personel, mukellef, hareketler, logs, scheduledMsgs, groups, botSettings}} setData={(d)=>{setPersonel(d.personel);setMukellef(d.mukellef);setHareketler(d.hareketler);setLogs(d.logs);setScheduledMsgs(d.scheduledMsgs);setGroups(d.groups||[]);setBotSettings(d.botSettings||botSettings)}} />}
                        </div>
                    </main>
                </div>
            );
        }

        // --- DASHBOARD (FÄ°NANSAL RÃ–NTGEN) ---
        function DashboardPage({ personel, mukellef, getBakiye, getDebtAge }) {
            const toplamCiro = useMemo(() => mukellef.reduce((a,b)=>a+ (b.aylikUcret || 0), 0), [mukellef]);
            
            // YaÅŸlandÄ±rma Analizi
            const aging = useMemo(() => {
                let buckets = { green: 0, yellow: 0, red: 0 };
                mukellef.forEach(m => {
                    const bakiye = getBakiye(m.id);
                    if (bakiye > 0) {
                        const days = getDebtAge(m.id);
                        if (days < 30) buckets.green += bakiye;
                        else if (days < 90) buckets.yellow += bakiye;
                        else buckets.red += bakiye;
                    }
                });
                return buckets;
            }, [mukellef, getBakiye, getDebtAge]);

            const totalDebt = aging.green + aging.yellow + aging.red;

            return (
                <div className="space-y-6 fade-in">
                    {/* FÄ°NANSAL RÄ°SK RADARI */}
                    <div className="bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-2xl">
                        <div className="flex justify-between items-end mb-4">
                            <h3 className="font-bold text-white text-lg"><i className="fas fa-radar text-emerald-400 mr-2"></i>Finansal Risk RadarÄ± (Alacak YaÅŸlandÄ±rma)</h3>
                            <span className="text-xs text-slate-500 font-mono">TOPLAM ALACAK: {totalDebt.toLocaleString()} â‚º</span>
                        </div>
                        <div className="flex h-6 rounded-full overflow-hidden mb-2 bg-slate-900">
                            <div className="age-green transition-all duration-1000" style={{width: `${(aging.green/totalDebt)*100}%`}}></div>
                            <div className="age-yellow transition-all duration-1000" style={{width: `${(aging.yellow/totalDebt)*100}%`}}></div>
                            <div className="age-red transition-all duration-1000" style={{width: `${(aging.red/totalDebt)*100}%`}}></div>
                        </div>
                        <div className="grid grid-cols-3 gap-4 text-center">
                            <div><p className="text-[10px] text-emerald-400 font-bold uppercase">0-30 GÃ¼n (Taze)</p><h4 className="text-xl font-bold text-white">{aging.green.toLocaleString()} â‚º</h4></div>
                            <div><p className="text-[10px] text-yellow-400 font-bold uppercase">30-90 GÃ¼n (Riskli)</p><h4 className="text-xl font-bold text-white">{aging.yellow.toLocaleString()} â‚º</h4></div>
                            <div><p className="text-[10px] text-red-500 font-bold uppercase">90+ GÃ¼n (YanÄ±k)</p><h4 className="text-xl font-bold text-white">{aging.red.toLocaleString()} â‚º</h4></div>
                        </div>
                    </div>

                     <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <StatCard title="PortfÃ¶y" val={mukellef.length} icon="fa-building" color="text-blue-500" />
                        <StatCard title="Beklenen Tahakkuk" val={`${toplamCiro.toLocaleString()} â‚º`} icon="fa-file-invoice-dollar" color="text-emerald-500" />
                        <StatCard title="Personel GÃ¼cÃ¼" val={personel.length} icon="fa-user-tie" color="text-purple-500" />
                    </div>
                </div>
            )
        }

        // --- PERSONEL PAGE (EFOR TERAZÄ°SÄ°) ---
        function PersonelPage({ personel, setPersonel, mukellef, setMukellef }) {
            const [modal, setModal] = useState(null);
            const [viewPortfolio, setViewPortfolio] = useState(null);
            const savePersonel = (p) => { if(p.id) setPersonel(personel.map(x=>x.id===p.id?p:x)); else setPersonel([...personel, {...p, id: Date.now()}]); setModal(null); };
            const calculateCost = (p) => (p.maas || 0) + (p.sgk || 0) + (p.yemek || 0) + (p.vergi || 0) + (p.diger || 0);

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex justify-between items-center"><h3 className="text-xl font-bold text-white">Personel KÃ¢rlÄ±lÄ±k & Efor Analizi</h3><button onClick={()=>setModal({ad:"", unvan:"", giris:"", maas:0, sgk:0, yemek:0, vergi:0, diger:0})} className="btn btn-primary">+ Ekle</button></div>
                    <div className="grid grid-cols-1 gap-6">
                        {personel.map(p => {
                            const musteriListesi = mukellef.filter(m => m.temsilci === p.ad);
                            const toplamCiro = musteriListesi.reduce((acc, m) => acc + (m.aylikUcret || 0), 0);
                            const toplamMaliyet = calculateCost(p);
                            const netKar = toplamCiro - toplamMaliyet;
                            
                            // EFOR HESABI
                            const toplamZorluk = musteriListesi.reduce((acc, m) => acc + (parseInt(m.zorlukPuani) || 5), 0);
                            const eforSkoru = toplamZorluk > 0 ? Math.round(toplamCiro / toplamZorluk) : 0; // Puan baÅŸÄ±na ciro

                            return (
                                <div key={p.id} className="glass-panel p-6 rounded-2xl flex flex-col md:flex-row gap-6 items-center border-l-4 hover:bg-white/5 transition" style={{borderLeftColor: netKar > 0 ? '#10b981' : '#ef4444'}}>
                                    <div className="w-full md:w-1/4">
                                        <h4 className="font-bold text-white text-lg">{p.ad}</h4>
                                        <p className="text-blue-400 text-sm">{p.unvan}</p>
                                        <button onClick={()=>setViewPortfolio(p.ad)} className="text-xs text-slate-400 underline mt-2 hover:text-white">PortfÃ¶yÃ¼ GÃ¶r ({musteriListesi.length})</button>
                                    </div>
                                    <div className="flex-1 grid grid-cols-4 gap-2 text-center w-full">
                                        <div className="bg-slate-900/50 p-2 rounded-lg"><p className="text-[10px] text-slate-500 uppercase">Maliyet</p><p className="font-bold text-red-400">{toplamMaliyet.toLocaleString()} â‚º</p></div>
                                        <div className="bg-slate-900/50 p-2 rounded-lg"><p className="text-[10px] text-slate-500 uppercase">Net KÃ¢r</p><p className={`font-bold ${netKar>0?'text-green-400':'text-red-500'}`}>{netKar.toLocaleString()} â‚º</p></div>
                                        
                                        {/* YENÄ°: ZORLUK GÃ–STERGESÄ° */}
                                        <div className="bg-slate-900/50 p-2 rounded-lg border border-purple-500/30">
                                            <p className="text-[10px] text-purple-400 uppercase">Toplam Ä°ÅŸ YÃ¼kÃ¼</p>
                                            <p className="font-bold text-white">{toplamZorluk} Puan</p>
                                        </div>
                                        <div className="bg-slate-900/50 p-2 rounded-lg border border-purple-500/30">
                                            <p className="text-[10px] text-purple-400 uppercase">Verim (Ciro/Efor)</p>
                                            <p className="font-bold text-white">{eforSkoru}</p>
                                        </div>
                                    </div>
                                    <div className="flex gap-2"><button onClick={()=>setModal(p)} className="text-blue-400 hover:text-white p-2"><i className="fas fa-edit"></i></button><button onClick={()=>{if(confirm("Silinecek?")) setPersonel(personel.filter(x=>x.id!==p.id))}} className="text-red-400 hover:text-white p-2"><i className="fas fa-trash"></i></button></div>
                                </div>
                            );
                        })}
                    </div>
                    {modal && <PersonelModal p={modal} onClose={()=>setModal(null)} onSave={savePersonel} />}
                    
                    {viewPortfolio && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 fade-in">
                            <div className="bg-slate-800 p-6 rounded-2xl w-[600px] border border-slate-600 max-h-[80vh] overflow-y-auto">
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold text-white text-lg">{viewPortfolio} - MÃ¼kellef Listesi</h3>
                                    <button onClick={()=>setViewPortfolio(null)} className="text-slate-400 hover:text-white"><i className="fas fa-times"></i></button>
                                </div>
                                <table className="w-full text-sm text-left">
                                    <thead className="bg-slate-900 text-slate-500"><tr><th className="p-2">Firma</th><th className="p-2 text-right">Zorluk</th><th className="p-2 text-right">Ãœcret</th></tr></thead>
                                    <tbody className="divide-y divide-slate-700">
                                        {mukellef.filter(m => m.temsilci === viewPortfolio).map(m => (
                                            <tr key={m.id}>
                                                <td className="p-2 text-white">{m.unvan}</td>
                                                <td className="p-2 text-right text-purple-400 font-bold">{m.zorlukPuani || 5} Puan</td>
                                                <td className="p-2 text-right text-slate-400">{m.aylikUcret.toLocaleString()} â‚º</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}
                </div>
            )
        }

        // --- WHATSAPP MOTORU (YAÅžLANDIRMA FÄ°LTRELERÄ° Ä°LE) ---
        function WhatsAppEngine({ mukellef, logs, sendApiMessage, setLogs, scheduledMsgs, setScheduledMsgs, groups, setGroups, getBakiye, botSettings, setBotSettings, getDebtAge }) {
            const [selected, setSelected] = useState([]);
            const [message, setMessage] = useState("");
            const [fileUrl, setFileUrl] = useState(""); 
            const [sending, setSending] = useState(false);
            const [progress, setProgress] = useState(0);
            const [scheduleDate, setScheduleDate] = useState("");
            const [tab, setTab] = useState('compose'); 
            const [filterMode, setFilterMode] = useState("all");
            const [searchTerm, setSearchTerm] = useState("");

            const templates = [
                { label: "ðŸ’° Ã–deme HatÄ±rlatma", text: "SayÄ±n MÃ¼kellefimiz, muhasebe Ã¼creti Ã¶demeniz gecikmiÅŸtir. Ã–demenizi rica eder, iyi Ã§alÄ±ÅŸmalar dileriz. - SMMM Halil AkÃ§a" },
                { label: "ðŸ“„ Evrak Talebi", text: "Ä°yi gÃ¼nler, cari dÃ¶nem evraklarÄ±nÄ±zÄ±n teslimi iÃ§in son gÃ¼ndÃ¼r. LÃ¼tfen evraklarÄ±nÄ±zÄ± ofisimize ulaÅŸtÄ±rÄ±nÄ±z." },
                { label: "âœ… KDV OnayÄ±", text: "SayÄ±n MÃ¼kellefimiz, KDV beyannameniz onaylanmÄ±ÅŸtÄ±r. Tahakkuk fiÅŸiniz ektedir." },
                { label: "ðŸŽ‰ Bayram", text: "Sevdiklerinizle beraber saÄŸlÄ±klÄ± ve mutlu bir bayram geÃ§irmenizi dilerim. - Halil AkÃ§a" }
            ];

            const filteredList = useMemo(() => {
                let list = mukellef;
                if (searchTerm) {
                    list = list.filter(m => m.unvan.toLowerCase().includes(searchTerm.toLowerCase()));
                }
                
                // YAÅžLANDIRMA FÄ°LTRELERÄ°
                if (filterMode === 'aging30') return list.filter(m => getBakiye(m.id) > 0 && getDebtAge(m.id) < 30);
                if (filterMode === 'aging90') return list.filter(m => getBakiye(m.id) > 0 && getDebtAge(m.id) >= 30 && getDebtAge(m.id) < 90);
                if (filterMode === 'agingOld') return list.filter(m => getBakiye(m.id) > 0 && getDebtAge(m.id) >= 90);
                
                if (filterMode === 'debt') return list.filter(m => getBakiye(m.id) > 0);
                if (filterMode === 'risky') return list.filter(m => m.odemeAliskanligi === 'Geciktiren');
                if (filterMode === 'safe') return list.filter(m => m.odemeAliskanligi === 'SÃ¶zÃ¼nÃ¼n Eri');
                return list;
            }, [mukellef, filterMode, getBakiye, searchTerm, getDebtAge]);

            const toggleSelect = (id) => setSelected(selected.includes(id) ? selected.filter(x=>x!==id) : [...selected, id]);
            const toggleAll = () => (selected.length === mukellef.length) ? setSelected([]) : setSelected(mukellef.map(m => m.id));
            const saveGroup = () => { const name = prompt("Grup AdÄ±:"); if(name) setGroups([...groups, {id: Date.now(), name, members: selected}]); };
            const selectGroup = (members) => setSelected(members.filter(id => mukellef.find(m => m.id === id)));
            const addPaymentLink = () => setMessage(prev => prev + `\n\nðŸ’³ GÃ¼venli Ã–deme: https://odeme.halilakca.com/pay/${Date.now()}`);

            const handleSend = async () => {
                if(!message || selected.length === 0) return alert("LÃ¼tfen Mesaj ve AlÄ±cÄ± SeÃ§in!");

                if (scheduleDate) {
                    const newTasks = selected.map(id => {
                        const m = mukellef.find(x => x.id === id);
                        return { id: Date.now() + Math.random(), to: m.unvan, tel: m.tel, msg: message, file: fileUrl, date: scheduleDate, status: 'Beklemede' };
                    });
                    setScheduledMsgs([...scheduledMsgs, ...newTasks]);
                    alert(`${newTasks.length} adet mesaj zamanlandÄ±!`);
                    setScheduleDate(""); setSelected([]); setMessage(""); setFileUrl(""); setTab('queue');
                    return;
                }

                setSending(true);
                for (let i = 0; i < selected.length; i++) {
                    const m = mukellef.find(x => x.id === selected[i]);
                    if(m && m.tel) {
                        await sendApiMessage(m.tel, message, fileUrl);
                        setProgress(Math.round(((i + 1) / selected.length) * 100));
                        await new Promise(r => setTimeout(r, 1000)); 
                    }
                }
                setSending(false); alert("GÃ¶nderim TamamlandÄ±!"); setProgress(0); setSelected([]); setMessage(""); setFileUrl("");
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 h-[80vh] fade-in">
                    {/* SOL PANEL */}
                    <div className="lg:col-span-3 bg-slate-800 rounded-3xl border border-slate-700 flex flex-col overflow-hidden">
                        <div className="p-4 border-b border-slate-700 bg-slate-900/50">
                            <h3 className="font-bold text-white mb-3 text-xs uppercase">AkÄ±llÄ± Filtreler</h3>
                            <input className="input-dark mb-3 text-xs border-emerald-900 focus:border-emerald-500" placeholder="Ä°simle HÄ±zlÄ± Ara..." value={searchTerm} onChange={e=>setSearchTerm(e.target.value)} />
                            
                            {/* YAÅžLANDIRMA BUTONLARI */}
                            <div className="grid grid-cols-3 gap-1 mb-2">
                                <button onClick={()=>setFilterMode('aging30')} className={`text-[9px] p-1 rounded font-bold ${filterMode==='aging30'?'bg-emerald-500 text-white':'bg-slate-700 text-emerald-500'}`}>0-30 GÃœN</button>
                                <button onClick={()=>setFilterMode('aging90')} className={`text-[9px] p-1 rounded font-bold ${filterMode==='aging90'?'bg-yellow-500 text-white':'bg-slate-700 text-yellow-500'}`}>30-90 GÃœN</button>
                                <button onClick={()=>setFilterMode('agingOld')} className={`text-[9px] p-1 rounded font-bold ${filterMode==='agingOld'?'bg-red-500 text-white':'bg-slate-700 text-red-500'}`}>90+ GÃœN</button>
                            </div>

                            <div className="grid grid-cols-2 gap-2 mb-3">
                                <button onClick={()=>setFilterMode('all')} className={`text-[10px] p-2 rounded ${filterMode==='all'?'bg-blue-600 text-white':'bg-slate-700 text-slate-400'}`}>TÃ¼mÃ¼</button>
                                <button onClick={()=>setFilterMode('debt')} className={`text-[10px] p-2 rounded ${filterMode==='debt'?'bg-red-600 text-white':'bg-slate-700 text-slate-400'}`}>BorÃ§lular</button>
                                <button onClick={()=>setFilterMode('risky')} className={`text-[10px] p-2 rounded ${filterMode==='risky'?'bg-orange-600 text-white':'bg-slate-700 text-slate-400'}`}>Geciktirenler</button>
                                <button onClick={()=>setFilterMode('safe')} className={`text-[10px] p-2 rounded ${filterMode==='safe'?'bg-emerald-600 text-white':'bg-slate-700 text-slate-400'}`}>SÃ¶zÃ¼nÃ¼n Eri</button>
                            </div>
                            <div className="flex gap-2 overflow-x-auto pb-2 custom-scrollbar">
                                {groups.map(g => <button key={g.id} onClick={()=>selectGroup(g.members)} className="px-2 py-1 bg-slate-700 text-emerald-400 rounded text-[10px] whitespace-nowrap hover:bg-slate-600 border border-slate-600">{g.name}</button>)}
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-2 custom-scrollbar space-y-1">
                            {filteredList.map(m => {
                                const days = getDebtAge(m.id);
                                const badgeColor = days > 90 ? 'bg-red-500' : days > 30 ? 'bg-yellow-500' : 'bg-emerald-500';
                                return (
                                    <div key={m.id} onClick={()=>toggleSelect(m.id)} className={`p-3 rounded-xl border cursor-pointer transition-all flex items-center justify-between ${selected.includes(m.id) ? 'bg-emerald-600 text-white border-emerald-500 shadow-lg' : 'bg-slate-900/40 border-slate-800 text-slate-400 hover:bg-slate-800'}`}>
                                        <div className="flex items-center gap-2 truncate">
                                            {selected.includes(m.id) && <i className="fas fa-check text-[10px]"></i>}
                                            <span className="text-xs font-bold truncate w-24">{m.unvan}</span>
                                        </div>
                                        {getBakiye(m.id) > 0 && <div className="flex items-center gap-1">
                                            <span className={`w-2 h-2 rounded-full ${badgeColor}`}></span>
                                            <span className="text-[9px] bg-slate-800 px-1 rounded">{getBakiye(m.id)}â‚º</span>
                                        </div>}
                                    </div>
                                )
                            })}
                        </div>
                        <div className="p-2 border-t border-slate-700">
                            <button onClick={saveGroup} className="w-full py-2 bg-slate-700 text-xs rounded hover:bg-slate-600 text-slate-300">SeÃ§imi Grup Olarak Kaydet</button>
                        </div>
                    </div>

                    {/* ORTA: EDÄ°TÃ–R */}
                    <div className="lg:col-span-6 flex flex-col gap-4">
                        <div className="bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-2xl flex-1 flex flex-col">
                            <div className="bg-gradient-to-r from-slate-800 to-slate-900 p-3 rounded-xl border border-purple-500/30 flex items-center justify-between mb-4">
                                <div>
                                    <h4 className="text-xs font-bold text-white flex items-center gap-2"><i className="fas fa-robot text-purple-400"></i> Otomatik Tahsilat Botu</h4>
                                    <p className="text-[9px] text-slate-400">Belirlenen limiti aÅŸanlara her Ã‡arÅŸamba mesaj atar.</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <input type="number" className="input-dark w-20 text-right h-6 text-[10px]" value={botSettings.limit} onChange={e=>setBotSettings({...botSettings, limit:e.target.value})} />
                                    <span className="text-[9px] text-slate-500">TL Ã¼zeri</span>
                                    <button onClick={()=>setBotSettings({...botSettings, active:!botSettings.active})} className={`w-8 h-4 rounded-full transition-colors ${botSettings.active?'bg-emerald-500':'bg-slate-600'}`}>
                                        <div className={`w-3 h-3 bg-white rounded-full shadow-md transform transition-transform mt-0.5 ml-0.5 ${botSettings.active?'translate-x-4':''}`}></div>
                                    </button>
                                </div>
                            </div>

                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-white text-lg">Mesaj OluÅŸturucu</h3>
                                <div className="flex gap-2">
                                    <button onClick={()=>setTab('queue')} className="text-xs bg-slate-900 px-3 py-1 rounded text-slate-400 hover:text-white"><i className="fas fa-clock mr-1"></i>ZamanlanmÄ±ÅŸ ({scheduledMsgs.length})</button>
                                </div>
                            </div>
                            <div className="flex gap-2 mb-4 overflow-x-auto pb-2 custom-scrollbar">
                                {templates.map((t,i) => (
                                    <button key={i} onClick={()=>setMessage(t.text)} className="whitespace-nowrap px-3 py-2 rounded-lg bg-emerald-900/30 border border-emerald-800 text-emerald-400 text-[10px] font-bold uppercase hover:bg-emerald-600 hover:text-white transition-all">{t.label}</button>
                                ))}
                            </div>
                            
                            <textarea className="flex-1 input-dark mb-2 resize-none border-slate-600 focus:border-emerald-500 text-sm font-medium" placeholder="MesajÄ±nÄ±zÄ± buraya yazÄ±n..." value={message} onChange={e=>setMessage(e.target.value)}></textarea>
                            
                            <div className="mb-4">
                                <button onClick={addPaymentLink} className="text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded-lg flex items-center gap-2 transition-all"><i className="fas fa-credit-card"></i> Tahsilat Linki Ãœret & Ekle</button>
                            </div>

                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="text-[10px] text-slate-500 uppercase font-bold mb-1 block">Dosya Ekle (URL)</label>
                                    <div className="flex items-center gap-2 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2">
                                        <i className="fas fa-paperclip text-slate-500"></i>
                                        <input type="text" className="bg-transparent w-full text-xs text-white outline-none" placeholder="https://..." value={fileUrl} onChange={e=>setFileUrl(e.target.value)} />
                                    </div>
                                </div>
                                <div>
                                    <label className="text-[10px] text-slate-500 uppercase font-bold mb-1 block">Zamanlama</label>
                                    <input type="datetime-local" className="bg-slate-900 border border-slate-600 text-white text-xs rounded-lg px-3 py-2 w-full outline-none focus:border-emerald-500" value={scheduleDate} onChange={e=>setScheduleDate(e.target.value)} />
                                </div>
                            </div>
                            {sending ? (
                                <div className="space-y-2">
                                    <div className="w-full bg-slate-900 rounded-full h-3 overflow-hidden"><div className="bg-emerald-500 h-full transition-all duration-300" style={{width: `${progress}%`}}></div></div>
                                    <p className="text-center text-[10px] text-emerald-400 uppercase font-bold animate-pulse">GÃ¶nderiliyor... %{progress}</p>
                                </div>
                            ) : (
                                <button onClick={handleSend} className="btn btn-wa w-full py-4 text-sm font-black uppercase tracking-widest shadow-emerald-600/30 shadow-lg">
                                    <i className={`fas ${scheduleDate ? 'fa-calendar-check' : 'fa-paper-plane'} text-lg`}></i> 
                                    {scheduleDate ? 'Zaman AyarlÄ± GÃ¶nder' : 'MesajlarÄ± BaÅŸlat'}
                                </button>
                            )}
                        </div>
                    </div>

                    {/* SAÄž: DURUM */}
                    <div className="lg:col-span-3 flex flex-col gap-4">
                         {tab === 'queue' ? (
                            <div className="flex-1 bg-slate-800 rounded-3xl border border-slate-700 flex flex-col overflow-hidden">
                                <div className="p-4 bg-slate-900/50 border-b border-slate-800 flex justify-between items-center">
                                    <h3 className="font-bold text-white text-xs uppercase">Bekleyenler</h3>
                                    <button onClick={()=>setTab('compose')} className="text-xs text-emerald-400">Kapat</button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar">
                                    {scheduledMsgs.length === 0 && <p className="text-center text-slate-500 text-xs mt-10">ZamanlanmÄ±ÅŸ mesaj yok.</p>}
                                    {scheduledMsgs.map(m => (
                                        <div key={m.id} className="p-3 bg-slate-900 rounded-xl border border-slate-800 text-xs relative overflow-hidden group">
                                            <div className="flex justify-between mb-1">
                                                <span className="font-bold text-white truncate w-20">{m.to}</span>
                                                <span className={`text-[10px] px-1.5 rounded ${m.status==='TamamlandÄ±'?'bg-emerald-500/20 text-emerald-400':'bg-yellow-500/20 text-yellow-500'}`}>{m.status}</span>
                                            </div>
                                            <div className="text-[10px] text-slate-500 mb-1"><i className="fas fa-clock mr-1"></i>{m.date.replace('T', ' ')}</div>
                                            <p className="text-slate-400 truncate opacity-70">"{m.msg}"</p>
                                            {m.status === 'Beklemede' && <button onClick={()=>setScheduledMsgs(scheduledMsgs.filter(x=>x.id!==m.id))} className="absolute top-2 right-2 text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i className="fas fa-trash"></i></button>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                         ) : (
                            <div className="flex-1 bg-slate-800 rounded-3xl border border-slate-700 flex flex-col overflow-hidden">
                                <div className="p-4 bg-slate-900/50 border-b border-slate-800">
                                    <h3 className="font-bold text-emerald-400 text-xs uppercase">CanlÄ± Log</h3>
                                </div>
                                <div className="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar">
                                    {logs.map(log => (
                                        <div key={log.id} className="p-3 bg-slate-900 rounded-xl border border-slate-800 text-xs font-mono">
                                            <div className="flex justify-between text-[10px] text-slate-500 mb-1">
                                                <span>{log.time.split(' ')[1]}</span>
                                                <span className="text-emerald-500">{log.status}</span>
                                            </div>
                                            <div className="text-white truncate">To: {log.to}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                         )}
                    </div>
                </div>
            )
        }
        function FinansPage({ mukellef, hareketler, setHareketler, getBakiye, getDebtAge }) { 
            const [selectedMId, setSelectedMId] = useState(mukellef[0]?.id || 0); const [view, setView] = useState('list'); const [activeYear, setActiveYear] = useState(2026); const [tahakkukModu, setTahakkukModu] = useState('aylik'); const [seciliAylar, setSeciliAylar] = useState([]); const aylar = ["Ocak","Åžubat","Mart","Nisan","MayÄ±s","Haziran","Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"]; const [tahsilat, setTahsilat] = useState({ tarih: new Date().toISOString().slice(0,10), tur: "Nakit", tutar: "", aciklama: "" }); 
            const m = mukellef.find(x => x.id == selectedMId); const bakiye = getBakiye(parseInt(selectedMId)); const mHareketler = hareketler.filter(h => h.mukellefId == selectedMId && h.tarih.includes(activeYear)); const debtAge = getDebtAge(parseInt(selectedMId));
            const handleTahakkuk = () => { const islemAylari = tahakkukModu === 'yillik' ? aylar : seciliAylar; if(islemAylari.length === 0) return alert("Ay seÃ§iniz."); const ucret = activeYear === 2026 ? m.ucret2026 : m.ucret2025; if(ucret === 0) return alert(`Dikkat! ${m.unvan} iÃ§in ${activeYear} yÄ±lÄ± Ã¼creti 0 TL gÃ¶rÃ¼nÃ¼yor.`); const newRecs = islemAylari.map(ay => ({ id: Date.now()+Math.random(), mukellefId: parseInt(selectedMId), tarih: `${activeYear}-` + (aylar.indexOf(ay)+1).toString().padStart(2, '0') + '-15', tur: 'borc', aciklama: `${ay} ${activeYear} Muhasebe Ãœcreti`, tutar: ucret })); setHareketler([...newRecs, ...hareketler]); alert("Ä°ÅŸlendi."); setView('list'); setSeciliAylar([]); }; const handleTahsilat = () => { if(!tahsilat.tutar) return alert("Tutar girin."); const newRec = { id: Date.now(), mukellefId: parseInt(selectedMId), tarih: tahsilat.tarih, tur: 'alacak', aciklama: `${tahsilat.tur} Tahsilat - ${tahsilat.aciklama}`, tutar: parseFloat(tahsilat.tutar) }; setHareketler([newRec, ...hareketler]); alert("Kaydedildi."); setView('list'); }; 
            return (<div className="space-y-6 fade-in"><div className="flex justify-center mb-4"><div className="bg-slate-800 p-1 rounded-xl flex gap-2 border border-slate-700"><button onClick={()=>setActiveYear(2025)} className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${activeYear===2025 ? 'bg-slate-600 text-white' : 'text-slate-500 hover:text-white'}`}>2025</button><button onClick={()=>setActiveYear(2026)} className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${activeYear===2026 ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-500 hover:text-white'}`}>2026</button></div></div><div className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex flex-col md:flex-row gap-4 items-center"><select className="input-dark w-full md:w-1/2" value={selectedMId} onChange={e=>setSelectedMId(e.target.value)}>{mukellef.map(x => <option key={x.id} value={x.id}>{x.unvan}</option>)}</select><div className="flex gap-2"><button onClick={()=>setView('tahakkuk')} className="btn btn-primary">BorÃ§landÄ±r ({activeYear})</button><button onClick={()=>setView('tahsilat')} className="btn btn-success">Tahsilat</button><button onClick={()=>setView('list')} className="btn bg-slate-700">Ekstre</button></div></div><div className="glass-panel p-6 rounded-xl flex justify-between items-center bg-slate-800/80"><div><p className="text-xs text-slate-400">Toplam Bakiye</p><h3 className="text-2xl font-bold text-white">{bakiye.toLocaleString()} â‚º</h3><span className={`text-[10px] px-2 py-1 rounded mt-1 inline-block ${debtAge>90?'bg-red-900 text-red-300':debtAge>30?'bg-yellow-900 text-yellow-300':'bg-green-900 text-green-300'}`}>{debtAge > 0 ? `${debtAge} GÃ¼ndÃ¼r Bekliyor` : 'GÃ¼ncel'}</span></div><div className="text-right"><p className="text-xs text-slate-400">{activeYear} YÄ±lÄ± Ãœcreti</p><h3 className="text-xl font-bold text-emerald-400">{activeYear===2025 ? m.ucret2025?.toLocaleString() : m.ucret2026?.toLocaleString()} â‚º</h3></div></div>{view === 'tahakkuk' && <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 fade-in"><h3 className="font-bold text-white mb-4">{activeYear} YÄ±lÄ± Tahakkuk Ä°ÅŸlemi</h3><div className="flex gap-4 mb-4"><button onClick={()=>setTahakkukModu('aylik')} className={`btn ${tahakkukModu==='aylik'?'bg-blue-600 text-white':'bg-slate-700'}`}>AylÄ±k</button><button onClick={()=>setTahakkukModu('yillik')} className={`btn ${tahakkukModu==='yillik'?'bg-blue-600 text-white':'bg-slate-700'}`}>TÃ¼m YÄ±l</button></div>{tahakkukModu === 'aylik' && <div className="grid grid-cols-4 gap-2 mb-4">{aylar.map(ay => (<button key={ay} onClick={()=>setSeciliAylar(seciliAylar.includes(ay)?seciliAylar.filter(x=>x!==ay):[...seciliAylar, ay])} className={`p-2 rounded text-xs font-bold border ${seciliAylar.includes(ay)?'bg-blue-600 border-blue-500 text-white':'border-slate-600 text-slate-400'}`}>{ay}</button>))}</div>}<button onClick={handleTahakkuk} className="btn btn-primary w-full">Onayla ve Ä°ÅŸle</button></div>}{view === 'tahsilat' && <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 fade-in max-w-lg mx-auto"><h3 className="font-bold text-white mb-4">Tahsilat GiriÅŸi</h3><div className="space-y-3"><div><label className="text-xs text-slate-500">Tarih</label><input type="date" className="input-dark" value={tahsilat.tarih} onChange={e=>setTahsilat({...tahsilat, tarih:e.target.value})} /></div><div><label className="text-xs text-slate-500">TÃ¼r</label><select className="input-dark" value={tahsilat.tur} onChange={e=>setTahsilat({...tahsilat, tur:e.target.value})}><option>Nakit</option><option>Banka Havale/EFT</option><option>Ã‡ek</option><option>Kredi KartÄ±</option></select></div><div><label className="text-xs text-slate-500">Tutar</label><input type="number" className="input-dark text-xl font-bold" placeholder="0.00" value={tahsilat.tutar} onChange={e=>setTahsilat({...tahsilat, tutar:e.target.value})} /></div><div><label className="text-xs text-slate-500">AÃ§Ä±klama</label><input type="text" className="input-dark" placeholder="Opsiyonel" value={tahsilat.aciklama} onChange={e=>setTahsilat({...tahsilat, aciklama:e.target.value})} /></div><button onClick={handleTahsilat} className="btn btn-success w-full mt-2">Kaydet</button></div></div>}{view === 'list' && <div className="glass-panel rounded-xl overflow-hidden"><table className="w-full text-left text-sm"><thead className="bg-slate-900 text-slate-500 font-bold"><tr><th className="p-3">Tarih</th><th className="p-3">AÃ§Ä±klama</th><th className="p-3 text-right text-red-400">BorÃ§</th><th className="p-3 text-right text-green-400">Alacak</th></tr></thead><tbody className="divide-y divide-slate-700">{mHareketler.map(h => (<tr key={h.id} className="hover:bg-slate-800/50"><td className="p-3 text-slate-400">{h.tarih}</td><td className="p-3 text-white font-medium">{h.aciklama}</td><td className="p-3 text-right text-red-400 font-mono">{h.tur==='borc'?h.tutar.toLocaleString():'-'}</td><td className="p-3 text-right text-green-400 font-mono">{h.tur==='alacak'?h.tutar.toLocaleString():'-'}</td></tr>))}</tbody></table></div>}</div>) 
        }
        function MukellefPage({ mukellef, setMukellef, personel, getBakiye }) { const [search, setSearch] = useState(""); const [modal, setModal] = useState(null); const [showZamModal, setShowZamModal] = useState(false); const [zamOrani, setZamOrani] = useState(30); const filtered = useMemo(() => mukellef.filter(m => m.unvan.toLowerCase().includes(search.toLowerCase())), [mukellef, search]); const saveM = (m) => { if(m.id) { setMukellef(prev => prev.map(x=>x.id===m.id?m:x)); } else { const newM = {...m, id: Date.now()}; setMukellef(prev => [...prev, newM]); } setModal(null); }; const topluZamYap = () => { const oran = parseFloat(zamOrani); if(!oran) return; if(confirm(`DÄ°KKAT! TÃ¼m mÃ¼kelleflerin 2025 Ã¼creti baz alÄ±narak %${oran} zam yapÄ±lacak ve 2026 hanesine yazÄ±lacak. OnaylÄ±yor musunuz?`)) { const updated = mukellef.map(m => { const bazUcret = m.ucret2025 || m.aylikUcret || 0; const yeniUcret = Math.round(bazUcret * (1 + oran/100)); return { ...m, ucret2026: yeniUcret }; }); setMukellef(updated); setShowZamModal(false); alert("Ä°ÅŸlem BaÅŸarÄ±yla TamamlandÄ±! 2026 Ãœcretleri GÃ¼ncellendi."); } }; return (<div className="space-y-6 fade-in"><div className="flex justify-between items-center gap-4"><input className="input-dark w-64 shadow-inner" placeholder="Ara..." value={search} onChange={e=>setSearch(e.target.value)} /><div className="flex gap-2"><button onClick={()=>setShowZamModal(true)} className="btn bg-purple-600 hover:bg-purple-500 text-white shadow-lg"><i className="fas fa-magic"></i> % Otomatik Zam Yap</button><button onClick={()=>setModal({unvan:"", tel:"", defter:"BILANÃ‡O", aylikUcret:0, ucret2025:0, ucret2026:0, zorlukPuani:5, odemeAliskanligi:'Normal', temsilci:personel[0]?.ad})} className="btn btn-primary">+ MÃ¼kellef Ekle</button></div></div>{showZamModal && (<div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 fade-in"><div className="bg-slate-800 p-8 rounded-2xl border border-purple-500/50 w-96 text-center"><div className="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-4"><i className="fas fa-robot text-2xl text-white"></i></div><h3 className="text-xl font-bold text-white mb-2">Otomatik Zam Robotu</h3><p className="text-xs text-slate-400 mb-6">2025 Ã¼cretlerini baz alarak 2026 iÃ§in toplu gÃ¼ncelleme yapar.</p><div className="flex items-center gap-2 mb-6 justify-center"><span className="text-white font-bold text-lg">%</span><input type="number" className="input-dark w-24 text-center text-xl font-bold text-purple-400" value={zamOrani} onChange={e=>setZamOrani(e.target.value)} /><span className="text-white font-bold text-lg">Zam</span></div><div className="flex gap-2"><button onClick={topluZamYap} className="btn bg-purple-600 hover:bg-purple-500 flex-1 text-white">BaÅŸlat</button><button onClick={()=>setShowZamModal(false)} className="btn bg-slate-700 flex-1 text-white">Ä°ptal</button></div></div></div>)}<div className="glass-panel rounded-2xl overflow-hidden border border-slate-700"><table className="w-full text-left text-sm"><thead className="bg-slate-900 text-slate-500 uppercase font-bold text-xs"><tr><th className="p-4">Firma</th><th className="p-4">Temsilci</th><th className="p-4 text-right">2025 Ãœcret</th><th className="p-4 text-right text-emerald-400">2026 Ãœcret (Yeni)</th><th className="p-4 text-right">Bakiye</th><th className="p-4 text-center">DÃ¼zenle</th></tr></thead><tbody className="divide-y divide-slate-800/50">{filtered.map(m => (<tr key={m.id} className="hover:bg-slate-800/50 transition"><td className="p-4"><div className="font-bold text-white truncate max-w-xs">{m.unvan}</div><div className="text-[10px] text-slate-500">{m.tel}</div></td><td className="p-4 text-xs text-slate-400">{m.temsilci}</td><td className="p-4 text-right font-mono text-slate-400">{m.ucret2025?.toLocaleString()} â‚º</td><td className="p-4 text-right font-mono font-bold text-emerald-400">{m.ucret2026?.toLocaleString()} â‚º</td><td className="p-4 text-right font-mono font-bold text-white">{getBakiye(m.id).toLocaleString()} â‚º</td><td className="p-4 text-center"><button onClick={()=>setModal(m)} className="text-blue-400 hover:text-white"><i className="fas fa-edit"></i></button></td></tr>))}</tbody></table></div>{modal && <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 fade-in"><div className="bg-slate-800 p-8 rounded-2xl w-full max-w-lg border border-slate-700"><h3 className="text-xl font-bold text-white mb-4">MÃ¼kellef KartÄ±</h3><div className="space-y-4"><input className="input-dark" placeholder="Ãœnvan" value={modal.unvan} onChange={e=>setModal({...modal, unvan:e.target.value})} /><div className="grid grid-cols-2 gap-4"><input className="input-dark" placeholder="Telefon" value={modal.tel} onChange={e=>setModal({...modal, tel:e.target.value})} /><select className="input-dark" value={modal.temsilci} onChange={e=>setModal({...modal, temsilci:e.target.value})}>{personel.map(p=><option key={p.id} value={p.ad}>{p.ad}</option>)}</select></div><div className="grid grid-cols-2 gap-4 bg-slate-900/50 p-4 rounded-xl border border-slate-600"><div><label className="text-[10px] text-slate-400 uppercase font-bold">2025 Ãœcreti</label><input type="number" className="input-dark text-slate-400" value={modal.ucret2025} onChange={e=>setModal({...modal, ucret2025:parseInt(e.target.value)})} /></div><div><label className="text-[10px] text-emerald-400 uppercase font-bold">2026 Ãœcreti (Yeni)</label><input type="number" className="input-dark text-emerald-400 font-bold" value={modal.ucret2026} onChange={e=>setModal({...modal, ucret2026:parseInt(e.target.value)})} /></div><div className="col-span-2 grid grid-cols-2 gap-4 pt-2 border-t border-slate-600"><div><label className="text-[10px] text-purple-400 uppercase font-bold">Zorluk (1-10)</label><input type="number" max="10" min="1" className="input-dark border-purple-500/30" value={modal.zorlukPuani} onChange={e=>setModal({...modal, zorlukPuani:e.target.value})} /></div><div><label className="text-[10px] text-purple-400 uppercase font-bold">Ã–deme Huyu</label><select className="input-dark border-purple-500/30" value={modal.odemeAliskanligi} onChange={e=>setModal({...modal, odemeAliskanligi:e.target.value})}><option>Normal</option><option>SÃ¶zÃ¼nÃ¼n Eri</option><option>Geciktiren</option><option>Riskli</option></select></div></div></div><div className="flex gap-2 mt-4"><button onClick={()=>saveM(modal)} className="btn btn-primary flex-1">Kaydet</button><button onClick={()=>setModal(null)} className="btn bg-slate-700 flex-1">Ä°ptal</button></div></div></div></div>}</div>) }
        function YedekPage({ data, setData }) { const download = () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type: "application/json"})); a.download = `akca_yedek.json`; a.click(); }; const upload = (e) => { const r = new FileReader(); r.onload = (ev) => { setData(JSON.parse(ev.target.result)); alert("YÃ¼klendi!"); }; r.readAsText(e.target.files[0]); }; return (<div className="grid grid-cols-2 gap-6 fade-in"><div className="glass-panel p-8 text-center rounded-xl hover:bg-white/5 cursor-pointer" onClick={download}><i className="fas fa-download text-4xl text-blue-500 mb-4"></i><h3>YedeÄŸi Ä°ndir</h3></div><div className="glass-panel p-8 text-center rounded-xl hover:bg-white/5 cursor-pointer relative"><input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={upload} /><i className="fas fa-upload text-4xl text-green-500 mb-4"></i><h3>Yedek YÃ¼kle</h3></div></div>) }
        function PersonelModal({ p, onClose, onSave }) { const [form, setForm] = useState(p); return (<div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 fade-in"><div className="bg-slate-800 p-8 rounded-2xl w-96 border border-slate-600 max-h-[90vh] overflow-y-auto custom-scrollbar"><h3 className="text-xl font-bold text-white mb-4">Personel KartÄ±</h3><div className="space-y-3"><input className="input-dark" placeholder="Ad Soyad" value={form.ad} onChange={e=>setForm({...form, ad:e.target.value})} /><input className="input-dark" placeholder="Ãœnvan" value={form.unvan} onChange={e=>setForm({...form, unvan:e.target.value})} /><input className="input-dark" type="date" value={form.giris} onChange={e=>setForm({...form, giris:e.target.value})} /><div className="border-t border-slate-700 pt-2"><label className="text-xs text-slate-500">Net MaaÅŸ</label><input className="input-dark" type="number" value={form.maas} onChange={e=>setForm({...form, maas:Number(e.target.value)})} /></div><div><label className="text-xs text-slate-500">SGK Maliyeti</label><input className="input-dark" type="number" value={form.sgk} onChange={e=>setForm({...form, sgk:Number(e.target.value)})} /></div><div><label className="text-xs text-slate-500">Yemek/Yol</label><input className="input-dark" type="number" value={form.yemek} onChange={e=>setForm({...form, yemek:Number(e.target.value)})} /></div><div><label className="text-xs text-slate-500">Vergi/Stopaj</label><input className="input-dark" type="number" value={form.vergi} onChange={e=>setForm({...form, vergi:Number(e.target.value)})} /></div><div><label className="text-xs text-slate-500">DiÄŸer</label><input className="input-dark" type="number" value={form.diger} onChange={e=>setForm({...form, diger:Number(e.target.value)})} /></div><div className="flex gap-2 mt-4"><button onClick={()=>onSave(form)} className="btn btn-primary flex-1">Kaydet</button><button onClick={onClose} className="btn bg-slate-700 flex-1">Ä°ptal</button></div></div></div></div>) }
        function StatCard({ title, val, icon, color }) { return (<div className="glass-panel p-6 rounded-xl flex justify-between items-start"><div><p className="text-xs text-slate-500 uppercase font-bold">{title}</p><h3 className="text-3xl font-bold text-white mt-1">{val}</h3></div><div className={`text-3xl ${color}`}><i className={`fas ${icon}`}></i></div></div>) }
        function MenuBtn({ icon, text, active, onClick, badge, isSpecial, isBackup }) { return (<div onClick={onClick} className={`flex items-center gap-3 p-3 rounded-xl cursor-pointer transition mb-1 border-l-4 ${active ? (isSpecial ? 'bg-emerald-600 text-white border-emerald-400 shadow-xl shadow-emerald-900/40' : 'bg-blue-600 text-white border-blue-400 shadow-xl') : (isBackup ? 'text-orange-400 hover:bg-slate-800 hover:text-white border-transparent' : 'text-slate-400 hover:bg-slate-800 hover:text-white border-transparent')}`}><i className={`fas ${icon} w-6 text-center text-lg ${!active && isSpecial ? 'text-emerald-500' : ''}`}></i><span className="text-sm font-bold uppercase italic flex-1 tracking-tight">{text}</span>{badge > 0 && <span className="text-[10px] bg-slate-900 px-2 py-0.5 rounded text-slate-300 font-bold">{badge}</span>}</div>) }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
