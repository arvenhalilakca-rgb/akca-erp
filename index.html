<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akça ERP v25.0 | Yönetici Konsolu</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@500;700;800&display=swap" rel="stylesheet">

<style>
    body { font-family: 'Inter', sans-serif; background: #0f172a; color: #e2e8f0; overflow: hidden; }
    h1, h2, h3, h4, .brand-font { font-family: 'Outfit', sans-serif; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
    .glass-sidebar { background: rgba(15, 23, 42, 0.95); border-right: 1px solid rgba(255, 255, 255, 0.05); }
    .glass-panel { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .input-dark { background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; width: 100%; outline: none; transition: 0.2s; font-family: 'Inter', sans-serif; }
    .input-dark:focus { border-color: #3b82f6; ring: 2px solid #3b82f6; }
    .btn { padding: 8px 16px; border-radius: 8px; font-weight: 600; transition: 0.2s; cursor: pointer; display: inline-flex; items-center; justify-content: center; gap: 8px; }
    .btn-primary { background: #2563eb; color: white; } .btn-primary:hover { background: #1d4ed8; }
    .btn-danger { background: #ef4444; color: white; } .btn-danger:hover { background: #dc2626; }
    .btn-success { background: #10b981; color: white; } .btn-success:hover { background: #059669; }
    .badge-bilanco { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
    .badge-isletme { background: rgba(16, 185, 129, 0.1); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

// --- SABİTLER ve VERİLER ---
const SISTEM_SIFRESI = "1453";
const API_CONFIG = {
    id: "7105435782",
    token: "9909ba226135436cb48ba61229ea6c7976122daff9b249b89c",
    baseUrl: "https://api.green-api.com"
};

const INITIAL_PERSONEL = [
    { id: 1, ad: "ÖZLEM", unvan: "S.M.M.M", maas: 35000 },
    { id: 2, ad: "TUĞÇE TETİK", unvan: "S.M.M.M", maas: 35000 },
    { id: 3, ad: "ÖMER", unvan: "Kıdemli Uzman", maas: 30000 },
    { id: 4, ad: "ASLI", unvan: "Uzman", maas: 28000 },
    { id: 5, ad: "TUĞÇE KUTLU", unvan: "Uzman Yrd.", maas: 25000 },
    { id: 6, ad: "EREN", unvan: "Personel", maas: 25000 },
    { id: 7, ad: "HALİL AKÇA", unvan: "Yönetici", maas: 0 }
];

// Listeyi kısaltarak ekliyorum, sistem çalıştığında localstorage'dan tam listeyi çekecek
const DEMO_MUKELLEF = [
    {"id": 1, "unvan": "18 Mart Özel Güvenlik Ltd. Şti.", "tel": "05419353101", "defter": "BILANÇO", "temsilci": "ÖZLEM", "aylikUcret": 14500},
    {"id": 29, "unvan": "Bigfoot Kafeterya Ltd Şti", "tel": "05369311982", "defter": "BILANÇO", "temsilci": "TUĞÇE TETİK", "aylikUcret": 12500},
    {"id": 118, "unvan": "Metal Güven Demir Çelik San.", "tel": "05393238219", "defter": "BILANÇO", "temsilci": "ÖZLEM", "aylikUcret": 50000}
];

// --- ANA UYGULAMA ---
function App() {
    const [page, setPage] = useState('login');
    const [password, setPassword] = useState("");
    const [error, setError] = useState("");

    const handleLogin = (e) => {
        e.preventDefault();
        if(password === SISTEM_SIFRESI) { setPage('dashboard'); }
        else { setError("Hatalı Şifre!"); }
    };

    return page === 'login' ? (
        <div className="flex h-screen w-full bg-[#0f172a] items-center justify-center fade-in relative overflow-hidden">
            <div className="absolute inset-0 bg-blue-600/5 blur-3xl rounded-full pointer-events-none"></div>
            <div className="glass-panel p-10 rounded-3xl w-96 text-center shadow-2xl relative z-10">
                <div className="w-20 h-20 bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-blue-600/30">
                    <i className="fas fa-chart-line text-3xl text-white"></i>
                </div>
                <h2 className="text-3xl font-bold text-white mb-1 brand-font">Akça ERP</h2>
                <p className="text-slate-400 text-sm mb-6">Yönetici Paneli v25.0</p>
                <form onSubmit={handleLogin} className="space-y-4">
                    <input type="password" className="input-dark text-center tracking-widest text-lg py-3" placeholder="Şifre" value={password} onChange={e=>setPassword(e.target.value)} autoFocus />
                    {error && <p className="text-red-400 text-xs font-bold">{error}</p>}
                    <button className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition shadow-lg">Giriş Yap</button>
                </form>
            </div>
        </div>
    ) : <DashboardLayout />;
}

// --- DASHBOARD LAYOUT ---
function DashboardLayout() {
    const [page, setPage] = useState('dashboard');
    // Veri Yönetimi
    const [personel, setPersonel] = useState(() => JSON.parse(localStorage.getItem('akca_v25_personel')) || INITIAL_PERSONEL);
    const [mukellef, setMukellef] = useState(() => JSON.parse(localStorage.getItem('akca_v25_mukellef')) || DEMO_MUKELLEF);
    const [hareketler, setHareketler] = useState(() => JSON.parse(localStorage.getItem('akca_v25_hareketler')) || []);
    const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('akca_v25_logs')) || []);

    // Otomatik Kayıt
    useEffect(() => {
        localStorage.setItem('akca_v25_personel', JSON.stringify(personel));
        localStorage.setItem('akca_v25_mukellef', JSON.stringify(mukellef));
        localStorage.setItem('akca_v25_hareketler', JSON.stringify(hareketler));
        localStorage.setItem('akca_v25_logs', JSON.stringify(logs));
    }, [personel, mukellef, hareketler, logs]);

    const getBakiye = (mId) => {
        const borc = hareketler.filter(h => h.mukellefId === mId && h.tur === 'borc').reduce((a,b)=>a+b.tutar,0);
        const alacak = hareketler.filter(h => h.mukellefId === mId && h.tur === 'alacak').reduce((a,b)=>a+b.tutar,0);
        return borc - alacak;
    };

    // WhatsApp API
    const sendApiMessage = async (tel, msg) => {
        if(!tel) return { success: false, error: 'No Number' };
        let cleanNumber = tel.replace(/\D/g, '');
        if (cleanNumber.length === 10) cleanNumber = '90' + cleanNumber;
        const chatId = `${cleanNumber}@c.us`;
        try {
            const response = await fetch(`${API_CONFIG.baseUrl}/waInstance${API_CONFIG.id}/SendMessage/${API_CONFIG.token}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chatId, message: msg })
            });
            const result = await response.json();
            if (result.idMessage) {
                setLogs(prev => [{ id: Date.now(), to: cleanNumber, msg, time: new Date().toLocaleTimeString(), status: 'OK' }, ...prev]);
                return { success: true };
            }
            return { success: false };
        } catch (err) { return { success: false, error: err }; }
    };

    return (
        <div className="flex h-screen w-full bg-[#0f172a] text-slate-300">
            {/* SIDEBAR */}
            <aside className="w-64 glass-sidebar flex flex-col z-20 shrink-0">
                <div className="p-6 border-b border-slate-800/50">
                    <h1 className="text-xl font-black text-white tracking-tight brand-font">AKÇA<span className="text-blue-500">ERP</span></h1>
                    <p className="text-[10px] font-bold text-slate-500 uppercase mt-1">Mali Müşavirlik Sistemi</p>
                </div>
                <nav className="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
                    <MenuBtn icon="fa-chart-pie" text="Genel Bakış" active={page==='dashboard'} onClick={()=>setPage('dashboard')} />
                    <MenuBtn icon="fa-users" text="Mükellef Listesi" active={page==='mukellef'} onClick={()=>setPage('mukellef')} badge={mukellef.length} />
                    <MenuBtn icon="fa-money-bill-transfer" text="Finans & Kasa" active={page==='finans'} onClick={()=>setPage('finans')} />
                    <MenuBtn icon="fa-user-tie" text="Personel" active={page==='personel'} onClick={()=>setPage('personel')} />
                    <MenuBtn icon="fab fa-whatsapp" text="Akça Robot" active={page==='robot'} onClick={()=>setPage('robot')} />
                    <MenuBtn icon="fa-database" text="Veri & Yedek" active={page==='yedek'} onClick={()=>setPage('yedek')} />
                </nav>
                <div className="p-4 bg-slate-900/50 text-center text-xs text-slate-600">
                    &copy; 2026 Halil Akça
                </div>
            </aside>

            {/* MAIN CONTENT */}
            <main className="flex-1 flex flex-col bg-slate-900 relative overflow-hidden">
                <header className="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900/90 z-10 sticky top-0 backdrop-blur-md">
                    <h2 className="font-bold text-white text-lg brand-font tracking-wide uppercase">{page}</h2>
                    <div className="flex items-center gap-3">
                        <div className="text-right hidden sm:block">
                            <p className="text-xs font-bold text-white leading-none">HALİL AKÇA</p>
                            <p className="text-[10px] text-slate-500 uppercase mt-1">Yönetici</p>
                        </div>
                        <div className="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold shadow-lg shadow-blue-600/20">HA</div>
                    </div>
                </header>

                <div className="flex-1 overflow-y-auto p-6 relative">
                    {page === 'dashboard' && <DashboardPage personel={personel} mukellef={mukellef} getBakiye={getBakiye} />}
                    {page === 'mukellef' && <MukellefPage mukellef={mukellef} setMukellef={setMukellef} personel={personel} getBakiye={getBakiye} sendApiMessage={sendApiMessage} />}
                    {page === 'finans' && <FinansPage mukellef={mukellef} hareketler={hareketler} setHareketler={setHareketler} />}
                    {page === 'personel' && <PersonelPage personel={personel} setPersonel={setPersonel} mukellef={mukellef} />}
                    {page === 'robot' && <RobotPage mukellef={mukellef} sendApiMessage={sendApiMessage} logs={logs} />}
                    {page === 'yedek' && <YedekPage data={{personel, mukellef, hareketler, logs}} setData={(d)=>{setPersonel(d.personel);setMukellef(d.mukellef);setHareketler(d.hareketler);setLogs(d.logs)}} />}
                </div>
            </main>
        </div>
    );
}

// --- SAYFALAR ---

function DashboardPage({ personel, mukellef, getBakiye }) {
    const toplamAlacak = useMemo(() => mukellef.reduce((a,b)=>a+getBakiye(b.id),0), [mukellef, getBakiye]);
    const toplamCiro = useMemo(() => mukellef.reduce((a,b)=>a+ (b.aylikUcret || 0), 0), [mukellef]);

    return (
        <div className="space-y-6 fade-in">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <StatCard title="TOPLAM MÜKELLEF" val={mukellef.length} icon="fa-building" color="text-blue-500" />
                <StatCard title="AYLIK TAHAKKUK" val={`${toplamCiro.toLocaleString('tr-TR')} ₺`} icon="fa-file-invoice-dollar" color="text-emerald-500" />
                <StatCard title="PİYASA ALACAĞI" val={`${toplamAlacak.toLocaleString('tr-TR')} ₺`} icon="fa-hand-holding-dollar" color="text-red-500" />
                <StatCard title="PERSONEL SAYISI" val={personel.length} icon="fa-users" color="text-purple-500" />
            </div>
            
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2 glass-panel p-6 rounded-2xl border-slate-700">
                    <h3 className="text-lg font-bold text-white mb-4 brand-font">Personel İş Yükü</h3>
                    <div className="space-y-4">
                        {personel.filter(p=>p.maas>0).map(p => {
                            const dosyaSayisi = mukellef.filter(m => m.temsilci === p.ad).length;
                            const yuzde = Math.min(100, Math.round((dosyaSayisi / 40) * 100)); // 40 dosya full kapasite varsayımı
                            return (
                                <div key={p.id}>
                                    <div className="flex justify-between text-xs font-medium mb-1">
                                        <span className="text-white">{p.ad}</span>
                                        <span className="text-slate-400">{dosyaSayisi} Dosya</span>
                                    </div>
                                    <div className="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                                        <div className={`h-full rounded-full transition-all duration-1000 ${yuzde>80?'bg-red-500':'bg-blue-500'}`} style={{width: `${yuzde}%`}}></div>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
                <div className="glass-panel p-6 rounded-2xl border-slate-700 flex flex-col items-center justify-center text-center">
                    <div className="w-16 h-16 bg-emerald-500/10 rounded-full flex items-center justify-center text-emerald-400 text-2xl mb-4 border border-emerald-500/20">
                        <i className="fas fa-trophy"></i>
                    </div>
                    <h4 className="text-xs font-bold text-slate-500 uppercase tracking-widest">Ayın Performansı</h4>
                    <p className="text-2xl font-black text-white mt-1 brand-font">ÖZLEM</p>
                    <p className="text-xs text-slate-400 mt-2">En yüksek ciro yönetimi ve tahsilat oranı.</p>
                </div>
            </div>
        </div>
    )
}

function MukellefPage({ mukellef, setMukellef, personel, getBakiye, sendApiMessage }) {
    const [search, setSearch] = useState("");
    const [filterTemsilci, setFilterTemsilci] = useState("all");
    const [modal, setModal] = useState(null);

    const filtered = mukellef.filter(m => {
        const s = (m.unvan || "").toLowerCase().includes(search.toLowerCase());
        const t = filterTemsilci === "all" || m.temsilci === filterTemsilci;
        return s && t;
    });

    const saveM = () => {
        if(modal.id) setMukellef(prev => prev.map(x=>x.id===modal.id?modal:x));
        else setMukellef(prev => [...prev, {...modal, id: Date.now()}]);
        setModal(null);
    };

    const hizliWhatsapp = (m) => {
        if(!m.tel) return alert("Telefon numarası kayıtlı değil!");
        const msg = `Sayın yetkili (${m.unvan}),\n\nGüncel bakiyeniz: ${getBakiye(m.id)} TL'dir. Ödemenizi rica ederiz.\n\nHalil Akça - SMMM`;
        if(confirm(`Bu mesaj gönderilsin mi?\n\n"${msg}"`)) {
            sendApiMessage(m.tel, msg).then(res => {
                alert(res.success ? "Mesaj gönderildi." : "Hata oluştu.");
            });
        }
    };

    return (
        <div className="space-y-6 fade-in">
            <div className="flex flex-wrap gap-4 justify-between">
                <div className="flex gap-2 w-full md:w-auto">
                    <input className="input-dark md:w-64" placeholder="Ünvan Ara..." value={search} onChange={e=>setSearch(e.target.value)} />
                    <select className="input-dark w-40" value={filterTemsilci} onChange={e=>setFilterTemsilci(e.target.value)}>
                        <option value="all">Tümü</option>
                        {personel.map(p=><option key={p.id} value={p.ad}>{p.ad}</option>)}
                    </select>
                </div>
                <button onClick={()=>setModal({unvan:"", tel:"", defter:"BILANÇO", aylikUcret:0, temsilci:personel[0]?.ad})} className="btn btn-primary shadow-lg shadow-blue-600/20"><i className="fas fa-plus"></i> Yeni Ekle</button>
            </div>

            <div className="glass-panel rounded-2xl overflow-hidden border-slate-700">
                <div className="overflow-x-auto">
                    <table className="w-full text-left text-sm text-slate-400">
                        <thead className="bg-slate-900/80 text-xs font-bold uppercase text-slate-500">
                            <tr>
                                <th className="p-4">Durum</th>
                                <th className="p-4">Ünvan</th>
                                <th className="p-4">Telefon</th>
                                <th className="p-4">Temsilci</th>
                                <th className="p-4 text-right">Ücret</th>
                                <th className="p-4 text-right">Bakiye</th>
                                <th className="p-4 text-center">İşlem</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-800">
                            {filtered.map(m => (
                                <tr key={m.id} className="hover:bg-slate-800/50 transition">
                                    <td className="p-4"><span className={m.defter==='BILANÇO'?'badge-bilanco':'badge-isletme'}>{m.defter}</span></td>
                                    <td className="p-4 font-medium text-slate-200">{m.unvan}</td>
                                    <td className="p-4 font-mono text-xs">{m.tel}</td>
                                    <td className="p-4"><span className="text-xs bg-slate-800 px-2 py-1 rounded border border-slate-700">{m.temsilci}</span></td>
                                    <td className="p-4 text-right font-mono text-emerald-400">{m.aylikUcret} ₺</td>
                                    <td className={`p-4 text-right font-mono font-bold ${getBakiye(m.id)>0?'text-red-400':'text-green-400'}`}>{getBakiye(m.id)} ₺</td>
                                    <td className="p-4 flex justify-center gap-2">
                                        <button onClick={()=>hizliWhatsapp(m)} className="w-8 h-8 rounded bg-green-900/30 text-green-400 hover:bg-green-600 hover:text-white transition flex items-center justify-center"><i className="fab fa-whatsapp"></i></button>
                                        <button onClick={()=>setModal(m)} className="w-8 h-8 rounded bg-blue-900/30 text-blue-400 hover:bg-blue-600 hover:text-white transition flex items-center justify-center"><i className="fas fa-pen"></i></button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>

            {modal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 fade-in">
                    <div className="bg-slate-900 border border-slate-700 p-6 rounded-2xl w-full max-w-lg shadow-2xl">
                        <h3 className="text-xl font-bold text-white mb-4 brand-font">Mükellef Kartı</h3>
                        <div className="space-y-3">
                            <div><label className="text-xs text-slate-500 uppercase font-bold">Ünvan</label><input className="input-dark" value={modal.unvan} onChange={e=>setModal({...modal, unvan:e.target.value})} /></div>
                            <div className="grid grid-cols-2 gap-3">
                                <div><label className="text-xs text-slate-500 uppercase font-bold">Telefon</label><input className="input-dark" value={modal.tel} onChange={e=>setModal({...modal, tel:e.target.value})} /></div>
                                <div><label className="text-xs text-slate-500 uppercase font-bold">Ücret</label><input type="number" className="input-dark" value={modal.aylikUcret} onChange={e=>setModal({...modal, aylikUcret:parseInt(e.target.value)||0})} /></div>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div><label className="text-xs text-slate-500 uppercase font-bold">Defter</label><select className="input-dark" value={modal.defter} onChange={e=>setModal({...modal, defter:e.target.value})}><option>BILANÇO</option><option>İŞLETME</option></select></div>
                                <div><label className="text-xs text-slate-500 uppercase font-bold">Temsilci</label><select className="input-dark" value={modal.temsilci} onChange={e=>setModal({...modal, temsilci:e.target.value})}>{personel.map(p=><option key={p.id} value={p.ad}>{p.ad}</option>)}</select></div>
                            </div>
                            <div className="flex gap-2 mt-4 pt-4 border-t border-slate-800">
                                <button onClick={saveM} className="btn btn-primary flex-1">Kaydet</button>
                                <button onClick={()=>setModal(null)} className="btn bg-slate-800 hover:bg-slate-700 text-slate-300 flex-1">İptal</button>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}

function FinansPage({ mukellef, hareketler, setHareketler }) {
    const [yeniIslem, setYeniIslem] = useState({ mukellefId: "", tur: "borc", tutar: "", aciklama: "" });

    const ekle = () => {
        if(!yeniIslem.mukellefId || !yeniIslem.tutar) return;
        setHareketler(prev => [{ id: Date.now(), tarih: new Date().toLocaleDateString(), ...yeniIslem, tutar: parseFloat(yeniIslem.tutar) }, ...prev]);
        setYeniIslem({ mukellefId: "", tur: "borc", tutar: "", aciklama: "" });
    };

    return (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 fade-in">
            <div className="glass-panel p-6 rounded-2xl border-slate-700">
                <h3 className="text-lg font-bold text-white mb-4 brand-font">Hızlı İşlem Ekle</h3>
                <div className="space-y-3">
                    <select className="input-dark" value={yeniIslem.mukellefId} onChange={e=>setYeniIslem({...yeniIslem, mukellefId: parseInt(e.target.value)})}>
                        <option value="">Mükellef Seçin...</option>
                        {mukellef.map(m => <option key={m.id} value={m.id}>{m.unvan}</option>)}
                    </select>
                    <div className="grid grid-cols-2 gap-2">
                        <select className="input-dark" value={yeniIslem.tur} onChange={e=>setYeniIslem({...yeniIslem, tur: e.target.value})}>
                            <option value="borc">Borç (Hizmet)</option>
                            <option value="alacak">Tahsilat</option>
                        </select>
                        <input type="number" className="input-dark" placeholder="Tutar" value={yeniIslem.tutar} onChange={e=>setYeniIslem({...yeniIslem, tutar: e.target.value})} />
                    </div>
                    <input className="input-dark" placeholder="Açıklama (Örn: Ocak Muhasebe)" value={yeniIslem.aciklama} onChange={e=>setYeniIslem({...yeniIslem, aciklama: e.target.value})} />
                    <button onClick={ekle} className="btn btn-primary w-full py-3">İşlemi Kaydet</button>
                </div>
            </div>
            <div className="lg:col-span-2 glass-panel p-6 rounded-2xl border-slate-700 overflow-hidden">
                <h3 className="text-lg font-bold text-white mb-4 brand-font">Son Hareketler</h3>
                <div className="overflow-y-auto max-h-[400px]">
                    <table className="w-full text-sm text-left text-slate-400">
                        <thead className="sticky top-0 bg-slate-900/90 text-xs font-bold uppercase text-slate-500">
                            <tr><th>Tarih</th><th>Mükellef</th><th>Açıklama</th><th className="text-right">Tutar</th></tr>
                        </thead>
                        <tbody className="divide-y divide-slate-800">
                            {hareketler.map(h => {
                                const m = mukellef.find(x=>x.id === h.mukellefId);
                                return (
                                    <tr key={h.id}>
                                        <td className="p-3 font-mono text-xs">{h.tarih}</td>
                                        <td className="p-3 font-medium text-slate-200">{m ? m.unvan : 'Silinmiş Mükellef'}</td>
                                        <td className="p-3">{h.aciklama}</td>
                                        <td className={`p-3 text-right font-mono font-bold ${h.tur==='alacak'?'text-green-400':'text-red-400'}`}>
                                            {h.tur==='alacak' ? '+' : '-'}{h.tutar} ₺
                                        </td>
                                    </tr>
                                )
                            })}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    )
}

function RobotPage({ mukellef, sendApiMessage, logs }) {
    const [msg, setMsg] = useState("");
    const [sending, setSending] = useState(false);

    const sendBulk = async () => {
        if(!msg) return;
        setSending(true);
        // Örnek olarak ilk 5 kişiye gönderir, gerçek kullanımda bu döngüyü tüm liste için açabilirsiniz.
        for(let m of mukellef.slice(0, 5)) {
            if(m.tel) await sendApiMessage(m.tel, msg);
        }
        setSending(false);
        alert("İşlem tamamlandı!");
    };

    return (
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 fade-in">
            <div className="glass-panel p-6 rounded-2xl border-slate-700">
                <h3 className="text-lg font-bold text-white mb-4 brand-font"><i className="fab fa-whatsapp text-green-500 mr-2"></i> Toplu Mesaj Robotu</h3>
                <textarea className="input-dark h-40 mb-4" placeholder="Mesajınızı buraya yazın..." value={msg} onChange={e=>setMsg(e.target.value)}></textarea>
                <div className="flex gap-2">
                    <button onClick={sendBulk} disabled={sending} className="btn btn-success flex-1 py-3">
                        {sending ? 'Gönderiliyor...' : 'Listeye Gönder'}
                    </button>
                    <button onClick={()=>setMsg("Sayın Mükellefimiz,\n\nSGK ve Vergi ödemelerinizi son güne bırakmamanızı önemle rica ederiz.\n\nHalil Akça")} className="btn bg-slate-800 text-slate-300">
                        Şablon 1
                    </button>
                </div>
                <p className="text-xs text-slate-500 mt-4">* Güvenlik nedeniyle şu an sadece listedeki ilk 5 kişiye gönderim yapar. Kodu düzenleyerek sınırı kaldırabilirsiniz.</p>
            </div>
            <div className="glass-panel p-6 rounded-2xl border-slate-700">
                <h3 className="text-lg font-bold text-white mb-4 brand-font">Gönderim Logları</h3>
                <div className="space-y-2 overflow-y-auto max-h-[300px]">
                    {logs.map(l => (
                        <div key={l.id} className="text-xs p-2 bg-slate-800 rounded border border-slate-700 flex justify-between">
                            <span className="text-slate-400">{l.time} -> {l.to}</span>
                            <span className="text-green-400 font-bold">{l.status}</span>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    )
}

function PersonelPage({ personel, setPersonel }) {
    return (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in">
            {personel.map(p => (
                <div key={p.id} className="glass-panel p-6 rounded-2xl border-slate-700 flex flex-col items-center text-center relative group hover:border-blue-500/50 transition">
                    <div className="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center text-2xl text-slate-400 mb-4 border border-slate-700 group-hover:bg-blue-600 group-hover:text-white transition">
                        {p.ad.substring(0,1)}
                    </div>
                    <h3 className="text-lg font-bold text-white brand-font">{p.ad}</h3>
                    <p className="text-sm text-blue-400 font-medium mb-4">{p.unvan}</p>
                    <div className="w-full bg-slate-800 rounded-xl p-3">
                        <p className="text-[10px] text-slate-500 uppercase font-bold">Maaş Hakediş</p>
                        <p className="text-xl font-mono font-bold text-white">{p.maas.toLocaleString()} ₺</p>
                    </div>
                </div>
            ))}
        </div>
    )
}

function YedekPage({ data, setData }) {
    const downloadJson = () => {
        const jsonString = `data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(data))}`;
        const link = document.createElement("a");
        link.href = jsonString;
        link.download = "akca_erp_yedek.json";
        link.click();
    };

    const uploadJson = (e) => {
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const importedData = JSON.parse(event.target.result);
                setData(importedData);
                alert("Yedek başarıyla yüklendi!");
            } catch(err) { alert("Hatalı dosya formatı!"); }
        };
        reader.readAsText(e.target.files[0]);
    };

    return (
        <div className="glass-panel p-8 rounded-2xl border-slate-700 max-w-2xl mx-auto text-center space-y-8 fade-in">
            <div>
                <i className="fas fa-shield-halved text-5xl text-blue-500 mb-4"></i>
                <h2 className="text-2xl font-bold text-white brand-font">Veri Güvenliği Merkezi</h2>
                <p className="text-slate-400 mt-2">Bu sistem verileri tarayıcınızda tutar. Veri kaybı yaşamamak için haftalık yedek alınız.</p>
            </div>
            <div className="grid grid-cols-2 gap-6">
                <div className="p-6 bg-slate-800/50 rounded-xl border border-slate-700 hover:border-green-500 transition cursor-pointer" onClick={downloadJson}>
                    <i className="fas fa-download text-3xl text-green-500 mb-3"></i>
                    <h3 className="font-bold text-white">Yedek İndir</h3>
                    <p className="text-xs text-slate-500 mt-1">Tüm verileri .json olarak bilgisayara kaydet.</p>
                </div>
                <div className="p-6 bg-slate-800/50 rounded-xl border border-slate-700 hover:border-blue-500 transition relative">
                    <input type="file" onChange={uploadJson} className="absolute inset-0 opacity-0 cursor-pointer" />
                    <i className="fas fa-upload text-3xl text-blue-500 mb-3"></i>
                    <h3 className="font-bold text-white">Yedek Yükle</h3>
                    <p className="text-xs text-slate-500 mt-1">Bilgisayardaki yedeği sisteme geri yükle.</p>
                </div>
            </div>
        </div>
    )
}

function MenuBtn({ icon, text, active, onClick, badge }) {
    return (
        <div onClick={onClick} className={`flex items-center gap-3 px-4 py-3 rounded-xl cursor-pointer transition-all duration-200 mb-1 group ${active ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/20' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
            <i className={`${icon} w-5 text-center text-lg`}></i>
            <span className="text-sm font-semibold flex-1">{text}</span>
            {badge > 0 && <span className="text-[10px] bg-slate-900 px-2 py-0.5 rounded-full text-slate-300 font-bold border border-slate-700">{badge}</span>}
        </div>
    )
}

function StatCard({ title, val, icon, color }) {
    return (
        <div className="glass-panel p-6 rounded-2xl border-slate-700 flex justify-between items-start">
            <div>
                <p className="text-[10px] text-slate-500 uppercase font-bold tracking-wider">{title}</p>
                <h3 className="text-2xl font-bold text-white mt-1 brand-font">{val}</h3>
            </div>
            <div className={`text-xl ${color} bg-slate-800 w-10 h-10 rounded-lg flex items-center justify-center border border-slate-700`}>
                <i className={`fas ${icon}`}></i>
            </div>
        </div>
    )
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
